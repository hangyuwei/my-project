{"version":3,"sources":["index.js","cloudbase.js","auth/index.js","utils/utils.js","const/code.js","const/symbol.js","utils/tcbapirequester.js","utils/tracing.js","utils/cloudplatform.js","utils/metadata.js","utils/tcbapiendpoint.js","utils/tcbcontext.js","utils/request.js","utils/retry.js","utils/request-timings-measurer.js","utils/request-core.js","utils/wxCloudToken.js","utils/version.js","utils/tcbopenapicommonrequester.js","utils/tcbopenapiendpoint.js","functions/index.js","cloudrun/index.js","utils/tcbopenapirequester.js","database/index.js","utils/tcbdbapirequester.js","storage/index.js","wx/index.js","analytics/index.js","ai/index.js","ai/request-adapter.js","logger/index.js","notification/index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA,AGTA;ADIA,ADGA,ADGA,AGTA;ADIA,ADGA,ADGA,AGTA;ADIA,ADGA,AGTA,AJYA,AGTA;ADIA,ADGA,AGTA,AJYA,AGTA;ADIA,ADGA,AGTA,AJYA,AGTA;ADIA,ADGA,AGTA,ACHA,ALeA,AGTA;ADIA,ADGA,AGTA,ACHA,ALeA,AGTA;ADIA,ADGA,AGTA,ACHA,ALeA,AGTA;ADIA,ADGA,AGTA,ACHA,ALeA,AMlBA,AHSA;ADIA,ADGA,AGTA,ACHA,ALeA,AMlBA,AHSA;ADIA,ADGA,AGTA,ACHA,ALeA,AMlBA,AHSA;ADIA,ADGA,AGTA,AJYA,AMlBA,ACHA,AJYA;ADIA,ADGA,AGTA,AJYA,AMlBA,ACHA,AJYA;ADIA,ADGA,AGTA,AENA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,AFMA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,AFMA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,AFMA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AHSA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AHSA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AHSA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,ACHA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,ACHA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,AFMA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,AFMA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,AFMA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,ACHA,AHSA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,ACHA,AHSA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AGTA,AIZA,ACHA,AGTA,ACHA,AHSA,AJYA,AKfA,AJYA,AJYA;ADIA,ADGA,AOrBA,ACHA,AKfA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AKfA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AKfA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA;ADIA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,AavCA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,AavCA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,AavCA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,ARwBA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,Af6CA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,Af6CA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,Af6CA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AOrBA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AmBzDA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AmBzDA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AmBzDA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AhBgDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,ADGA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,AHSA,AJYA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AZoCA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA;Ad2CA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA,AU9BA;AxByEA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA,AU9BA;AxByEA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,ACHA,AGTA,AnByDA,Ac1CA,ADGA,AU9BA;ACFA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AnByDA,Ac1CA,ADGA,AU9BA;ACFA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AnByDA,Ac1CA,ADGA,AU9BA;ACFA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AnByDA,Ac1CA,ADGA,AU9BA;AELA,ADGA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ADGA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ADGA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AKfA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,AENA,AHSA,AU9BA,ALeA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ALeA,ADGA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AjBmDA,ACHA,AMlBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AjBmDA,AOrBA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,ANkBA,AU9BA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AavCA,ANkBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ACHA,ANkBA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ACHA,APqBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ANkBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ANkBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ANkBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,AFMA,ANkBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AoB5DA,ADGA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AELA,ACHA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AU9BA,ALeA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,AFMA,AzB2EA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,ADGA,ARwBA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AmBzDA,AKfA,AV8BA,AT2BA,AKfA,AOrBA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A3BiFA,ADGA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA,AIZA;AGRA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AYpCA,AIZA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA,AgBhDA;AOpBA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AV8BA,AT2BA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,A5BoFA,AwBxEA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AuBpEA,AJYA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA,AnByDA;AmBxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\nconst cloudbase_1 = require(\"./cloudbase\");\nconst symbol_1 = require(\"./const/symbol\");\nconst utils_1 = require(\"./utils/utils\");\nconst request_1 = require(\"./utils/request\");\nconst version_1 = require(\"./utils/version\");\nmodule.exports = {\n    version: version_1.version,\n    SYMBOL_CURRENT_ENV: symbol_1.SYMBOL_CURRENT_ENV,\n    SYMBOL_DEFAULT_ENV: symbol_1.SYMBOL_DEFAULT_ENV,\n    init: (config) => {\n        return new cloudbase_1.CloudBase(config);\n    },\n    parseContext: (context) => {\n        return cloudbase_1.CloudBase.parseContext(context);\n    },\n    getCloudbaseContext: (context) => {\n        return cloudbase_1.CloudBase.getCloudbaseContext(context);\n    },\n    request: request_1.extraRequest,\n    setThrowOnCode: utils_1.setThrowOnCode\n};\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CloudBase = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst wx_cloud_client_sdk_1 = __importDefault(require(\"@cloudbase/wx-cloud-client-sdk\"));\nconst auth_1 = require(\"./auth\");\nconst functions_1 = require(\"./functions\");\nconst cloudrun_1 = require(\"./cloudrun\");\nconst database_1 = require(\"./database\");\nconst storage_1 = require(\"./storage\");\nconst wx_1 = require(\"./wx\");\nconst analytics_1 = require(\"./analytics\");\nconst ai_1 = require(\"./ai\");\nconst logger_1 = require(\"./logger\");\nconst code_1 = require(\"./const/code\");\nconst utils = __importStar(require(\"./utils/utils\"));\nconst cloudplatform_1 = require(\"./utils/cloudplatform\");\nconst tcbcontext_1 = require(\"./utils/tcbcontext\");\nconst notification_1 = require(\"./notification\");\nconst openapicommonrequester = __importStar(require(\"./utils/tcbopenapicommonrequester\"));\nconst tcbopenapiendpoint_1 = require(\"./utils/tcbopenapiendpoint\");\nconst symbol_1 = require(\"./const/symbol\");\nclass CloudBase {\n    static parseContext(context) {\n        const parseResult = (0, tcbcontext_1.parseContext)(context);\n        CloudBase.scfContext = parseResult;\n        return parseResult;\n    }\n    static getCloudbaseContext(context) {\n        return (0, tcbcontext_1.getCloudbaseContext)(context);\n    }\n    constructor(config) {\n        this.init(config);\n    }\n    init(config = {}) {\n        var _a, _b, _c, _d;\n        // 预检运行环境，调用与否并不影响后续逻辑\n        // 注意：该函数为异步函数，这里并不等待检查结果\n        /* eslint-disable-next-line */\n        (0, cloudplatform_1.preflightRuntimeCloudPlatform)();\n        const { debug, secretId, secretKey, sessionToken, env, timeout, headers = {} } = config, restConfig = __rest(config, [\"debug\", \"secretId\", \"secretKey\", \"sessionToken\", \"env\", \"timeout\", \"headers\"]);\n        if (('secretId' in config && !('secretKey' in config)) || (!('secretId' in config) && 'secretKey' in config)) {\n            throw utils.E(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'secretId and secretKey must be a pair' }));\n        }\n        const newConfig = Object.assign(Object.assign({}, restConfig), { debug: !!debug, secretId,\n            secretKey,\n            sessionToken,\n            env, envName: env, headers: Object.assign({}, headers), timeout: timeout || 15000 });\n        if ((_a = config.context) === null || _a === void 0 ? void 0 : _a.extendedContext) {\n            const extendedContext = config.context.extendedContext;\n            if (!newConfig.env) {\n                newConfig.env = extendedContext.envId;\n                newConfig.envName = newConfig.env;\n            }\n            // 从 context 中获取 secret\n            if (!newConfig.secretId && !newConfig.secretKey) {\n                newConfig.secretId = (_b = extendedContext === null || extendedContext === void 0 ? void 0 : extendedContext.tmpSecret) === null || _b === void 0 ? void 0 : _b.secretId;\n                newConfig.secretKey = (_c = extendedContext === null || extendedContext === void 0 ? void 0 : extendedContext.tmpSecret) === null || _c === void 0 ? void 0 : _c.secretKey;\n                newConfig.sessionToken = (_d = extendedContext === null || extendedContext === void 0 ? void 0 : extendedContext.tmpSecret) === null || _d === void 0 ? void 0 : _d.token;\n            }\n        }\n        this.config = newConfig;\n        this.extensionMap = new Map();\n        // NOTE：try-catch 为防止 init 报错\n        try {\n            // 初始化数据模型等 SDK 方法\n            const envId = this.config.envName === symbol_1.SYMBOL_CURRENT_ENV\n                ? openapicommonrequester.getEnvIdFromContext()\n                : this.config.envName;\n            const httpClient = wx_cloud_client_sdk_1.default.generateHTTPClient(this.callFunction.bind(this), async (options) => {\n                var _a;\n                const result = await openapicommonrequester.request({\n                    config: this.config,\n                    data: safeParseJSON(options.body),\n                    method: (_a = options.method) === null || _a === void 0 ? void 0 : _a.toUpperCase(),\n                    url: options.url,\n                    headers: Object.assign({ 'Content-Type': 'application/json' }, headersInitToRecord(options.headers)),\n                    token: (await this.auth().getClientCredential()).access_token\n                });\n                return result.body;\n            }, (0, tcbopenapiendpoint_1.buildCommonOpenApiUrlWithPath)({ serviceUrl: this.config.serviceUrl, envId, path: '/v1/model', region: this.config.region }), {\n                sqlBaseUrl: (0, tcbopenapiendpoint_1.buildCommonOpenApiUrlWithPath)({ serviceUrl: this.config.serviceUrl, envId, path: '/v1/sql', region: this.config.region })\n            });\n            this.models = httpClient;\n        }\n        catch (e) {\n            // ignore\n        }\n        try {\n            const getEntity = (options) => {\n                const envId = this.config.envName === symbol_1.SYMBOL_CURRENT_ENV\n                    ? openapicommonrequester.getEnvIdFromContext()\n                    : this.config.envName;\n                const { instance = 'default', database = envId } = options || {};\n                const mysqlClient = wx_cloud_client_sdk_1.default.generateMySQLClient(this, {\n                    mysqlBaseUrl: (0, tcbopenapiendpoint_1.buildCommonOpenApiUrlWithPath)({\n                        serviceUrl: this.config.serviceUrl,\n                        envId,\n                        path: '/v1/rdb/rest',\n                        region: this.config.region\n                    }),\n                    fetch: async (url, options) => {\n                        var _a;\n                        let headers = {};\n                        if (options.headers instanceof Headers) {\n                            options.headers.forEach((value, key) => {\n                                headers[key] = value;\n                            });\n                        }\n                        else {\n                            headers = options.headers || {};\n                        }\n                        const result = await openapicommonrequester.request({\n                            config: this.config,\n                            data: safeParseJSON(options.body),\n                            method: (_a = options.method) === null || _a === void 0 ? void 0 : _a.toUpperCase(),\n                            url: url instanceof URL ? url.href : String(url),\n                            headers: Object.assign({ 'Content-Type': 'application/json' }, headersInitToRecord(Object.assign({ 'X-Db-Instance': instance, 'Accept-Profile': database, 'Content-Profile': database }, headers))),\n                            token: (await this.auth().getClientCredential()).access_token\n                        });\n                        const data = result.body;\n                        const res = {\n                            ok: (result === null || result === void 0 ? void 0 : result.statusCode) >= 200 && (result === null || result === void 0 ? void 0 : result.statusCode) < 300,\n                            status: (result === null || result === void 0 ? void 0 : result.statusCode) || 200,\n                            statusText: (result === null || result === void 0 ? void 0 : result.statusMessage) || 'OK',\n                            json: async () => await Promise.resolve(data || {}),\n                            text: async () => await Promise.resolve(typeof data === 'string' ? data : JSON.stringify(data || {})),\n                            headers: new Headers(incomingHttpHeadersToHeadersInit((result === null || result === void 0 ? void 0 : result.headers) || {}))\n                        };\n                        return res;\n                    }\n                });\n                return mysqlClient;\n            };\n            this.mysql = (options) => {\n                return getEntity(options)(options);\n            };\n            this.rdb = (options) => {\n                return getEntity(options)(options);\n            };\n        }\n        catch (e) {\n            // ignore\n        }\n    }\n    logger() {\n        if (!this.clsLogger) {\n            this.clsLogger = (0, logger_1.logger)();\n        }\n        return this.clsLogger;\n    }\n    auth() {\n        return (0, auth_1.auth)(this);\n    }\n    database(dbConfig = {}) {\n        return (0, database_1.newDb)(this, dbConfig);\n    }\n    ai() {\n        if (!this.aiInstance) {\n            this.aiInstance = (0, ai_1.createAI)(this);\n        }\n        return this.aiInstance;\n    }\n    async callFunction(callFunctionOptions, opts) {\n        return await (0, functions_1.callFunction)(this, callFunctionOptions, opts);\n    }\n    async callContainer(callContainerOptions, opts) {\n        return await (0, cloudrun_1.callContainer)(this, callContainerOptions, opts);\n    }\n    async callApis(callApiOptions, opts) {\n        return await (0, functions_1.callApis)(this, callApiOptions, opts);\n    }\n    async callWxOpenApi(wxOpenApiOptions, opts) {\n        return await (0, wx_1.callWxOpenApi)(this, wxOpenApiOptions, opts);\n    }\n    async callWxPayApi(wxOpenApiOptions, opts) {\n        return await (0, wx_1.callWxPayApi)(this, wxOpenApiOptions, opts);\n    }\n    async wxCallContainerApi(wxOpenApiOptions, opts) {\n        return await (0, wx_1.wxCallContainerApi)(this, wxOpenApiOptions, opts);\n    }\n    async callCompatibleWxOpenApi(wxOpenApiOptions, opts) {\n        return await (0, wx_1.callCompatibleWxOpenApi)(this, wxOpenApiOptions, opts);\n    }\n    async uploadFile({ cloudPath, fileContent }, opts) {\n        return await (0, storage_1.uploadFile)(this, { cloudPath, fileContent }, opts);\n    }\n    async downloadFile({ fileID, urlType, tempFilePath }, opts) {\n        return await (0, storage_1.downloadFile)(this, { fileID, urlType, tempFilePath }, opts);\n    }\n    /**\n     * 复制文件\n     *\n     * @param fileList 复制列表\n     * @param fileList.srcPath 源文件路径\n     * @param fileList.dstPath 目标文件路径\n     * @param fileList.overwrite 当目标文件已经存在时，是否允许覆盖已有文件，默认 true\n     * @param fileList.removeOriginal 复制文件后是否删除源文件，默认不删除\n     * @param opts\n     */\n    async copyFile({ fileList }, opts) {\n        return await (0, storage_1.copyFile)(this, { fileList }, opts);\n    }\n    async deleteFile({ fileList }, opts) {\n        return await (0, storage_1.deleteFile)(this, { fileList }, opts);\n    }\n    async getTempFileURL({ fileList }, opts) {\n        return await (0, storage_1.getTempFileURL)(this, { fileList }, opts);\n    }\n    async getFileInfo({ fileList }, opts) {\n        return await (0, storage_1.getFileInfo)(this, { fileList }, opts);\n    }\n    async getUploadMetadata({ cloudPath }, opts) {\n        return await (0, storage_1.getUploadMetadata)(this, { cloudPath }, opts);\n    }\n    async getFileAuthority({ fileList }, opts) {\n        return await (0, storage_1.getFileAuthority)(this, { fileList }, opts);\n    }\n    /**\n     * @deprecated\n     */\n    async analytics(reportData) {\n        await (0, analytics_1.analytics)(this, reportData);\n    }\n    registerExtension(ext) {\n        this.extensionMap.set(ext.name, ext);\n    }\n    async invokeExtension(name, opts) {\n        const ext = this.extensionMap.get(name);\n        if (!ext) {\n            throw Error(`Please register '${name}' extension before invoke.`);\n        }\n        return ext.invoke(opts, this);\n    }\n    // SDK推送消息（对外API：sendTemplateNotification）\n    async sendTemplateNotification(params, opts) {\n        return await (0, notification_1.sendNotification)(this, params, opts);\n    }\n    /**\n     * shim for tcb extension ci\n     */\n    get requestClient() {\n        return {\n            get: axios_1.default,\n            post: axios_1.default,\n            put: axios_1.default,\n            delete: axios_1.default\n        };\n    }\n}\nexports.CloudBase = CloudBase;\nfunction headersInitToRecord(headers) {\n    if (!headers) {\n        return {};\n    }\n    const ret = {};\n    if (Array.isArray(headers)) {\n        headers.forEach(([key, value]) => {\n            ret[key] = value;\n        });\n    }\n    else if (typeof headers.forEach === 'function') {\n        headers.forEach(([key, value]) => {\n            ret[key] = value;\n        });\n    }\n    else {\n        Object.keys(headers).forEach((key) => {\n            ret[key] = headers[key];\n        });\n    }\n    return ret;\n}\nfunction safeParseJSON(x) {\n    try {\n        return JSON.parse(x);\n    }\n    catch (e) {\n        return x;\n    }\n}\nfunction incomingHttpHeadersToHeadersInit(headers) {\n    const result = [];\n    for (const [key, value] of Object.entries(headers)) {\n        if (value === undefined) {\n            continue;\n        }\n        if (Array.isArray(value)) {\n            for (const v of value) {\n                result.push([key, v]);\n            }\n        }\n        else {\n            result.push([key, value]);\n        }\n    }\n    return result;\n}\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.auth = exports.Auth = void 0;\nconst jsonwebtoken_1 = __importDefault(require(\"jsonwebtoken\"));\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst cloudbase_1 = require(\"../cloudbase\");\nconst symbol_1 = require(\"../const/symbol\");\nconst tcbapicaller = __importStar(require(\"../utils/tcbapirequester\"));\nconst tcbopenapicommonrequester = __importStar(require(\"../utils/tcbopenapicommonrequester\"));\nconst checkCustomUserIdRegex = /^[a-zA-Z0-9_\\-#@~=*(){}[\\]:.,<>+]{4,32}$/;\nfunction validateUid(uid) {\n    if (typeof uid !== 'string') {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'uid must be a string' }));\n    }\n    if (!checkCustomUserIdRegex.test(uid)) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: `Invalid uid: \"${uid}\"` }));\n    }\n}\nclass Auth {\n    constructor(cloudbase) {\n        this.cloudbase = cloudbase;\n    }\n    async getAuthContext(context) {\n        const { TCB_UUID, LOGINTYPE, QQ_OPENID, QQ_APPID } = cloudbase_1.CloudBase.getCloudbaseContext(context);\n        const result = {\n            uid: TCB_UUID,\n            loginType: LOGINTYPE\n        };\n        if (LOGINTYPE === 'QQ-MINI') {\n            result.appId = QQ_APPID;\n            result.openId = QQ_OPENID;\n        }\n        return result;\n    }\n    getClientIP() {\n        const { TCB_SOURCE_IP } = cloudbase_1.CloudBase.getCloudbaseContext();\n        return TCB_SOURCE_IP || '';\n    }\n    getUserInfo() {\n        const { WX_OPENID, WX_APPID, TCB_UUID, TCB_CUSTOM_USER_ID, TCB_ISANONYMOUS_USER } = cloudbase_1.CloudBase.getCloudbaseContext();\n        return {\n            openId: WX_OPENID || '',\n            appId: WX_APPID || '',\n            uid: TCB_UUID || '',\n            customUserId: TCB_CUSTOM_USER_ID || '',\n            isAnonymous: TCB_ISANONYMOUS_USER === 'true'\n        };\n    }\n    async getEndUserInfo(uid, opts) {\n        const { WX_OPENID, WX_APPID, TCB_UUID, TCB_CUSTOM_USER_ID, TCB_ISANONYMOUS_USER } = cloudbase_1.CloudBase.getCloudbaseContext();\n        const defaultUserInfo = {\n            openId: WX_OPENID || '',\n            appId: WX_APPID || '',\n            uid: TCB_UUID || '',\n            customUserId: TCB_CUSTOM_USER_ID || '',\n            isAnonymous: TCB_ISANONYMOUS_USER === 'true'\n        };\n        if (uid === undefined) {\n            return await Promise.resolve({\n                userInfo: defaultUserInfo\n            });\n        }\n        validateUid(uid);\n        return await tcbapicaller.request({\n            config: this.cloudbase.config,\n            params: {\n                action: 'auth.getUserInfoForAdmin',\n                uuid: uid\n            },\n            method: 'post',\n            opts,\n            headers: {\n                'content-type': 'application/json'\n            }\n        }).then(result => {\n            if (result.code) {\n                return result;\n            }\n            return {\n                userInfo: Object.assign(Object.assign({}, defaultUserInfo), result.data),\n                requestId: result.requestId\n            };\n        });\n    }\n    async queryUserInfo(query, opts) {\n        const { uid, platform, platformId } = query;\n        return await tcbapicaller.request({\n            config: this.cloudbase.config,\n            params: {\n                action: 'auth.getUserInfoForAdmin',\n                uuid: uid,\n                platform,\n                platformId\n            },\n            method: 'post',\n            opts,\n            headers: {\n                'content-type': 'application/json'\n            }\n        }).then(result => {\n            if (result.code) {\n                return result;\n            }\n            return {\n                userInfo: Object.assign({}, result.data),\n                requestId: result.requestId\n            };\n        });\n    }\n    async getClientCredential(opts) {\n        return await tcbopenapicommonrequester.request({\n            config: this.cloudbase.config,\n            method: 'POST',\n            opts,\n            headers: {\n                'content-type': 'application/json'\n            },\n            path: '/auth/v1/token/clientCredential',\n            data: {\n                grant_type: 'client_credentials'\n            }\n        }).then(result => {\n            return result.body;\n        });\n    }\n    createTicket(uid, options = {}) {\n        validateUid(uid);\n        const timestamp = new Date().getTime();\n        const { TCB_ENV, SCF_NAMESPACE } = cloudbase_1.CloudBase.getCloudbaseContext();\n        const { credentials } = this.cloudbase.config;\n        /* eslint-disable-next-line */\n        const { env_id } = credentials;\n        let { envName } = this.cloudbase.config;\n        if (!envName) {\n            throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'no env in config' }));\n        }\n        // 检查 credentials 是否包含 env\n        if (!env_id) {\n            throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '当前私钥未包含env_id 信息， 请前往腾讯云云开发控制台，获取自定义登录最新私钥' }));\n        }\n        // 使用symbol时替换为环境变量内的env\n        if (envName === symbol_1.SYMBOL_CURRENT_ENV) {\n            envName = TCB_ENV || SCF_NAMESPACE;\n        }\n        else if (envName === symbol_1.SYMBOL_DEFAULT_ENV) {\n            // nothing to do\n        }\n        // 检查 credentials env 和 init 指定 env 是否一致\n        if (env_id && env_id !== envName) {\n            throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '当前私钥所属环境与 init 指定环境不一致！' }));\n        }\n        if (!Reflect.has(options, 'allowInsecureKeySizes')) {\n            options.allowInsecureKeySizes = true;\n        }\n        const { refresh = 3600 * 1000, expire = timestamp + 7 * 24 * 60 * 60 * 1000 } = options;\n        const token = jsonwebtoken_1.default.sign({\n            alg: 'RS256',\n            env: envName,\n            iat: timestamp,\n            exp: timestamp + 10 * 60 * 1000,\n            uid,\n            refresh,\n            expire\n        }, credentials.private_key, {\n            allowInsecureKeySizes: options.allowInsecureKeySizes === true,\n            algorithm: 'RS256'\n        });\n        return credentials.private_key_id + '/@@/' + token;\n    }\n}\nexports.Auth = Auth;\nfunction auth(cloudbase) {\n    return new Auth(cloudbase);\n}\nexports.auth = auth;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isValidEnvFormat = exports.isPageModuleName = exports.processReturn = exports.setThrowOnCode = exports.second = exports.isNonEmptyString = exports.E = exports.filterUndefined = exports.filterValue = exports.isAppId = exports.TcbError = void 0;\nclass TcbError extends Error {\n    constructor(error) {\n        super(error.message);\n        this.code = error.code;\n        this.message = error.message;\n        this.requestId = error.requestId || '';\n    }\n}\nexports.TcbError = TcbError;\nfunction isAppId(appIdStr) {\n    return /^[1-9][0-9]{4,64}$/gim.test(appIdStr);\n}\nexports.isAppId = isAppId;\nfunction filterValue(o, value) {\n    for (const key in o) {\n        if (o[key] === value) {\n            /* eslint-disable-next-line @typescript-eslint/no-dynamic-delete */\n            delete o[key];\n        }\n    }\n}\nexports.filterValue = filterValue;\nfunction filterUndefined(o) {\n    filterValue(o, undefined);\n}\nexports.filterUndefined = filterUndefined;\nfunction E(errObj) {\n    return new TcbError(errObj);\n}\nexports.E = E;\nfunction isNonEmptyString(str) {\n    return typeof str === 'string' && str !== '';\n}\nexports.isNonEmptyString = isNonEmptyString;\nfunction second() {\n    // istanbul ignore next\n    return Math.floor(new Date().getTime() / 1000);\n}\nexports.second = second;\n// 兼容模式开关，兼容模式下，不抛出异常，直接返回\nlet throwOnCode = true;\nfunction setThrowOnCode(value) {\n    throwOnCode = value;\n}\nexports.setThrowOnCode = setThrowOnCode;\nfunction processReturn(result) {\n    if (!throwOnCode) {\n        // 不抛报错，直接返回\n        return result;\n    }\n    throw E(Object.assign({}, result));\n}\nexports.processReturn = processReturn;\n/**\n * 是否是场景模块名\n *\n * $: 前缀，表示SaaS场景模块名，非实际环境ID，当前通过特殊环境ID标识\n *\n * @param envId\n * @returns\n */\nfunction isPageModuleName(envId = '') {\n    return typeof envId === 'string' && envId.startsWith('$:');\n}\nexports.isPageModuleName = isPageModuleName;\n// 20 + 1 + 16, 限制长度 40\nconst kEnvRuleReg = /^[a-z0-9_-]{1,40}$/;\nfunction isValidEnvFormat(env = '') {\n    return typeof env === 'string' && kEnvRuleReg.test(env);\n}\nexports.isValidEnvFormat = isValidEnvFormat;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ERROR = void 0;\nexports.ERROR = {\n    INVALID_PARAM: {\n        code: 'INVALID_PARAM',\n        message: 'invalid param'\n    },\n    SYS_ERR: {\n        code: 'SYS_ERR',\n        message: 'system error'\n    },\n    STORAGE_REQUEST_FAIL: {\n        code: 'STORAGE_REQUEST_FAIL',\n        message: 'storage request fail'\n    },\n    STORAGE_FILE_NONEXIST: {\n        code: 'STORAGE_FILE_NONEXIST',\n        message: 'storage file not exist'\n    },\n    TCB_CLS_UNOPEN: {\n        code: 'TCB_CLS_UNOPEN',\n        message: '需要先开通日志检索功能'\n    },\n    INVALID_CONTEXT: {\n        code: 'INVALID_CONTEXT',\n        message: '无效的context对象，请使用 云函数入口的context参数'\n    }\n};\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SYMBOL_DEFAULT_ENV = exports.SYMBOL_CURRENT_ENV = void 0;\nexports.SYMBOL_CURRENT_ENV = Symbol.for('SYMBOL_CURRENT_ENV'); // 当前环境\nexports.SYMBOL_DEFAULT_ENV = Symbol.for('SYMBOL_DEFAULT_ENV'); // 默认环境\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.request = exports.TcbApiHttpRequester = exports.prepareCredentials = exports.getCredentialsOnDemand = exports.getEnvIdFromContext = void 0;\nconst http_1 = __importDefault(require(\"http\"));\n/* eslint-disable-next-line */\nconst url_1 = require(\"url\");\nconst signature_nodejs_1 = require(\"@cloudbase/signature-nodejs\");\nconst code_1 = require(\"../const/code\");\nconst symbol_1 = require(\"../const/symbol\");\nconst tracing_1 = require(\"./tracing\");\nconst utils = __importStar(require(\"./utils\"));\nconst cloudbase_1 = require(\"../cloudbase\");\nconst cloudplatform_1 = require(\"./cloudplatform\");\nconst tcbapiendpoint_1 = require(\"./tcbapiendpoint\");\nconst request_1 = require(\"./request\");\nconst wxCloudToken_1 = require(\"./wxCloudToken\");\nconst version_1 = require(\"./version\");\nconst { E, second, processReturn } = utils;\nfunction getEnvIdFromContext() {\n    const { TCB_ENV, SCF_NAMESPACE } = cloudbase_1.CloudBase.getCloudbaseContext();\n    return TCB_ENV || SCF_NAMESPACE || '';\n}\nexports.getEnvIdFromContext = getEnvIdFromContext;\nfunction getCredentialsOnDemand(credentials) {\n    const { secretId, secretKey } = credentials;\n    let newCredentials = credentials;\n    // 原本这里只在SCF云函数环境下，运行支持任意环境通过环境变量传递密钥\n    if (!secretId || !secretKey) {\n        // 尝试从环境变量中读取\n        const { TENCENTCLOUD_SECRETID, TENCENTCLOUD_SECRETKEY, TENCENTCLOUD_SESSIONTOKEN } = cloudbase_1.CloudBase.getCloudbaseContext();\n        if (TENCENTCLOUD_SECRETID && TENCENTCLOUD_SECRETKEY) {\n            newCredentials = {\n                secretId: TENCENTCLOUD_SECRETID,\n                secretKey: TENCENTCLOUD_SECRETKEY,\n                sessionToken: TENCENTCLOUD_SESSIONTOKEN\n            };\n        }\n        // 注意：CBR 环境下，已经禁止该方式获取临时密钥，这里实际是不会成功的\n        // if (checkIsInCBR()) {\n        //   const tmpSecret = await getTmpSecret()\n        //   newCredentials = {\n        //     secretId: tmpSecret.id,\n        //     secretKey: tmpSecret.key,\n        //     sessionToken: tmpSecret.token\n        //   }\n        //   return newCredentials\n        // }\n        // if (await checkIsInTencentCloud()) {\n        //   const tmpSecret = await getTmpSecret()\n        //   newCredentials = {\n        //     secretId: tmpSecret.id,\n        //     secretKey: tmpSecret.key,\n        //     sessionToken: tmpSecret.token\n        //   }\n        //   return newCredentials\n        // }\n    }\n    return newCredentials;\n}\nexports.getCredentialsOnDemand = getCredentialsOnDemand;\nasync function prepareCredentials() {\n    const opts = this.opts;\n    // CrossAccountInfo: 跨账号调用\n    const getCrossAccountInfo = opts.getCrossAccountInfo || this.config.getCrossAccountInfo;\n    /* istanbul ignore if */\n    if (getCrossAccountInfo) {\n        const crossAccountInfo = await getCrossAccountInfo();\n        const { credential } = crossAccountInfo;\n        const { secretId, secretKey, token } = credential || {};\n        this.config = Object.assign(Object.assign({}, this.config), { secretId,\n            secretKey, sessionToken: token });\n        if (!this.config.secretId || !this.config.secretKey) {\n            throw E(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'missing secretId or secretKey of tencent cloud' }));\n        }\n        // 替换掉原函数，缓存数据，这里缓存是否起作用，取决于 this 实例是否复用\n        // 另一处获取 authorization 的代码可以服用吃这里的缓存\n        this.opts.getCrossAccountInfo = async () => await Promise.resolve(crossAccountInfo);\n    }\n    else {\n        const { secretId, secretKey, sessionToken } = this.config;\n        const credentials = getCredentialsOnDemand({ secretId, secretKey, sessionToken });\n        this.config = Object.assign(Object.assign({}, this.config), { secretId: credentials.secretId, secretKey: credentials.secretKey, sessionToken: credentials.sessionToken });\n        if (!this.config.secretId || !this.config.secretKey) {\n            throw E(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'missing secretId or secretKey of tencent cloud, please set secretId and secretKey in config' }));\n        }\n    }\n}\nexports.prepareCredentials = prepareCredentials;\nclass TcbApiHttpRequester {\n    constructor(args) {\n        var _a, _b;\n        this.defaultTimeout = 15000;\n        this.timestamp = new Date().valueOf();\n        /* eslint-disable no-undef */\n        this.slowWarnTimer = null;\n        /* eslint-enable no-undef */\n        this.hooks = {};\n        this.args = args;\n        this.config = args.config;\n        this.opts = args.opts || {};\n        this.tracingInfo = (0, tracing_1.generateTracingInfo)((_b = (_a = args.config) === null || _a === void 0 ? void 0 : _a.context) === null || _b === void 0 ? void 0 : _b.eventID);\n    }\n    async request() {\n        await this.prepareCredentials();\n        const params = await this.makeParams();\n        const opts = this.makeReqOpts(params);\n        const action = this.getAction();\n        const key = {\n            functions: 'function_name',\n            database: 'collectionName',\n            wx: 'apiName'\n        }[action.split('.')[0]];\n        const argopts = this.opts;\n        const config = this.config;\n        // 注意：必须初始化为 null\n        let retryOptions = null;\n        if (argopts.retryOptions) {\n            retryOptions = argopts.retryOptions;\n        }\n        else if (config.retries && typeof config.retries === 'number') {\n            retryOptions = { retries: config.retries };\n        }\n        return await (0, request_1.extraRequest)(opts, {\n            debug: config.debug,\n            op: `${action}:${this.args.params[key]}@${params.envName}`,\n            seqId: this.tracingInfo.seqId,\n            retryOptions,\n            timingsMeasurerOptions: config.timingsMeasurerOptions || {}\n        }).then((response) => {\n            this.slowWarnTimer && clearTimeout(this.slowWarnTimer);\n            const { body } = response;\n            if (response.statusCode === 200) {\n                let result;\n                try {\n                    result = typeof body === 'string' ? JSON.parse(body) : body;\n                    if (this.hooks && this.hooks.handleData) {\n                        result = this.hooks.handleData(result, null, response, body);\n                    }\n                }\n                catch (e) {\n                    result = body;\n                }\n                return result;\n            }\n            else {\n                const e = E({\n                    code: response.statusCode,\n                    message: `${response.statusCode} ${http_1.default.STATUS_CODES[response.statusCode]} | [${opts.url}]`\n                });\n                throw e;\n            }\n        });\n    }\n    setHooks(hooks) {\n        Object.assign(this.hooks, hooks);\n    }\n    setSlowWarning(timeout) {\n        const action = this.getAction();\n        const { seqId } = this.tracingInfo;\n        this.slowWarnTimer = setTimeout(() => {\n            /* istanbul ignore next */\n            const msg = `[TCB][WARN] Your current request ${action\n                || ''} is longer than 3s, it may be due to the network or your query performance | [${seqId}]`;\n            /* istanbul ignore next */\n            console.warn(msg);\n        }, timeout);\n    }\n    getAction() {\n        return this.args.params.action;\n    }\n    async makeParams() {\n        const { TCB_SESSIONTOKEN } = cloudbase_1.CloudBase.getCloudbaseContext();\n        const args = this.args;\n        const opts = this.opts;\n        const config = this.config;\n        const crossAuthorizationData = opts.getCrossAccountInfo && (await opts.getCrossAccountInfo()).authorization;\n        const { wxCloudApiToken, wxCloudbaseAccesstoken } = (0, wxCloudToken_1.getWxCloudToken)();\n        const params = Object.assign(Object.assign({}, args.params), { envName: config.envName || '', wxCloudApiToken,\n            wxCloudbaseAccesstoken, tcb_sessionToken: TCB_SESSIONTOKEN || '', sessionToken: config.sessionToken, crossAuthorizationToken: crossAuthorizationData\n                ? Buffer.from(JSON.stringify(crossAuthorizationData)).toString('base64')\n                : '' });\n        if (!params.envName) {\n            if ((0, cloudplatform_1.checkIsInScf)()) {\n                params.envName = getEnvIdFromContext();\n                console.warn(`[TCB][WARN] 当前未指定env，将默认使用当前函数所在环境的环境：${params.envName}！`);\n            }\n            else {\n                console.warn('[TCB][WARN] 当前未指定env，将默认使用第一个创建的环境！');\n            }\n        }\n        // 取当前云函数环境时，替换为云函数下环境变量\n        if (params.envName === symbol_1.SYMBOL_CURRENT_ENV) {\n            params.envName = getEnvIdFromContext();\n        }\n        else if (params.envName === symbol_1.SYMBOL_DEFAULT_ENV) {\n            // 这里传空字符串没有可以跟不传的情况做一个区分\n            params.envName = '';\n        }\n        utils.filterUndefined(params);\n        return params;\n    }\n    makeReqOpts(params) {\n        var _a;\n        const config = this.config;\n        const args = this.args;\n        const url = (0, tcbapiendpoint_1.buildUrl)({\n            envId: params.envName || '',\n            region: this.config.region,\n            protocol: this.config.protocol || 'https',\n            serviceUrl: this.config.serviceUrl,\n            seqId: this.tracingInfo.seqId,\n            isInternal: this.args.isInternal\n        });\n        const method = this.args.method || 'get';\n        const timeout = ((_a = this.args.opts) === null || _a === void 0 ? void 0 : _a.timeout) || this.config.timeout || this.defaultTimeout;\n        const opts = {\n            url,\n            method,\n            timeout,\n            // 优先取config，其次取模块，最后取默认\n            headers: this.getHeaders(method, url, params),\n            proxy: config.proxy\n        };\n        if (typeof config.keepalive === 'undefined' && !(0, cloudplatform_1.checkIsInScf)()) {\n            // 非云函数环境下，默认开启 keepalive\n            opts.keepalive = true;\n        }\n        else {\n            /** eslint-disable-next-line */\n            opts.keepalive = typeof config.keepalive === 'boolean' && config.keepalive;\n        }\n        if (args.method === 'post') {\n            if (args.isFormData) {\n                opts.formData = params;\n                opts.encoding = null;\n            }\n            else {\n                opts.body = params;\n                opts.json = true;\n            }\n        }\n        else {\n            /* istanbul ignore next */\n            opts.qs = params;\n        }\n        return opts;\n    }\n    async prepareCredentials() {\n        prepareCredentials.bind(this)();\n    }\n    getHeaders(method, url, params) {\n        var _a;\n        const config = this.config;\n        const { context, secretId, secretKey } = config;\n        const args = this.args;\n        const { TCB_SOURCE } = cloudbase_1.CloudBase.getCloudbaseContext();\n        // Note: 云函数被调用时可能调用端未传递 SOURCE，TCB_SOURCE 可能为空\n        const SOURCE = `${((_a = context === null || context === void 0 ? void 0 : context.extendedContext) === null || _a === void 0 ? void 0 : _a.source) || TCB_SOURCE || ''},${args.opts.runEnvTag}`;\n        // 注意：因为 url.parse 和 url.URL 存在差异，因 url.parse 已被废弃，这里可能会需要改动。\n        // 因 @cloudbase/signature-nodejs sign 方法目前内部使用 url.parse 解析 url，\n        // 如果这里需要改动，需要注意与 @cloudbase/signature-nodejs 的兼容性\n        // 否则将导致签名存在问题\n        const parsedUrl = (0, url_1.parse)(url);\n        // const parsedUrl = new URL(url)\n        let requiredHeaders = {\n            'User-Agent': `tcb-node-sdk/${version_1.version}`,\n            'X-TCB-Source': SOURCE,\n            'X-Client-Timestamp': this.timestamp,\n            'X-SDK-Version': `tcb-node-sdk/${version_1.version}`,\n            Host: parsedUrl.host\n        };\n        if (config.version) {\n            requiredHeaders['X-SDK-Version'] = config.version;\n        }\n        if (this.tracingInfo.trace) {\n            requiredHeaders['X-TCB-Tracelog'] = this.tracingInfo.trace;\n        }\n        const region = this.config.region || process.env.TENCENTCLOUD_REGION || '';\n        if (region) {\n            requiredHeaders['X-TCB-Region'] = region;\n        }\n        requiredHeaders = Object.assign(Object.assign(Object.assign({}, config.headers), args.headers), requiredHeaders);\n        const { authorization, timestamp } = (0, signature_nodejs_1.sign)({\n            secretId,\n            secretKey,\n            method,\n            url,\n            params,\n            headers: requiredHeaders,\n            withSignedParams: true,\n            timestamp: second() - 1\n        });\n        /* eslint-disable @typescript-eslint/dot-notation */\n        requiredHeaders['Authorization'] = authorization;\n        requiredHeaders['X-Signature-Expires'] = 600;\n        requiredHeaders['X-Timestamp'] = timestamp;\n        return Object.assign({}, requiredHeaders);\n    }\n}\nexports.TcbApiHttpRequester = TcbApiHttpRequester;\nconst handleWxOpenApiData = (res, err, response, body) => {\n    // wx.openApi 调用时，需用content-type区分buffer or JSON\n    const { headers } = response;\n    let transformRes = res;\n    if (headers['content-type'] === 'application/json; charset=utf-8') {\n        transformRes = JSON.parse(transformRes.toString()); // JSON错误时buffer转JSON\n    }\n    return transformRes;\n};\nasync function request(args) {\n    if (typeof args.isInternal === 'undefined') {\n        args.isInternal = await (0, cloudplatform_1.checkIsInternalAsync)();\n    }\n    args.opts = args.opts || {};\n    args.opts.runEnvTag = await (0, cloudplatform_1.getCurrRunEnvTag)();\n    const requester = new TcbApiHttpRequester(args);\n    const { action } = args.params;\n    if (action === 'wx.openApi' || action === 'wx.wxPayApi') {\n        requester.setHooks({ handleData: handleWxOpenApiData });\n    }\n    if (action.startsWith('database') && process.env.SILENCE !== 'true') {\n        requester.setSlowWarning(3000);\n    }\n    const result = await requester.request();\n    if (result === null || result === void 0 ? void 0 : result.code) {\n        return processReturn(result);\n    }\n    return result;\n}\nexports.request = request;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateTracingInfo = void 0;\nconst cloudbase_1 = require(\"../cloudbase\");\nlet seqNum = 0;\nfunction getSeqNum() {\n    return ++seqNum;\n}\nfunction generateEventId() {\n    return Date.now().toString(16) + '_' + getSeqNum().toString(16);\n}\nconst generateTracingInfo = (id) => {\n    const { TCB_SEQID = '', TCB_TRACELOG } = cloudbase_1.CloudBase.getCloudbaseContext();\n    const eventId = generateEventId();\n    const seqId = id\n        ? `${id}-${eventId}`\n        : (TCB_SEQID ? `${TCB_SEQID}-${eventId}` : eventId);\n    return { eventId, seqId, trace: TCB_TRACELOG };\n};\nexports.generateTracingInfo = generateTracingInfo;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getCurrRunEnvTag = exports.checkIsInternalAsync = exports.checkIsInternal = exports.checkIsInTencentCloud = exports.checkIsInSumeru = exports.checkIsInCBR = exports.checkIsInScf = exports.getCloudPlatform = exports.preflightRuntimeCloudPlatform = exports.hasPreflight = void 0;\nconst metadata_1 = require(\"./metadata\");\nconst utils_1 = require(\"./utils\");\nvar CloudPlatform;\n(function (CloudPlatform) {\n    CloudPlatform[\"Unknown\"] = \"\";\n    CloudPlatform[\"TencentCloud\"] = \"tencentcloud\";\n    CloudPlatform[\"Other\"] = \"other\";\n})(CloudPlatform || (CloudPlatform = {}));\nlet hasDetected = false;\nlet cloudPlatform = CloudPlatform.Unknown;\nfunction hasPreflight() {\n    return hasDetected;\n}\nexports.hasPreflight = hasPreflight;\nasync function preflightRuntimeCloudPlatform() {\n    if (hasDetected) {\n        return;\n    }\n    if (await checkIsInternalAsync()) {\n        cloudPlatform = CloudPlatform.TencentCloud;\n    }\n    else {\n        cloudPlatform = CloudPlatform.Other;\n    }\n    hasDetected = true;\n}\nexports.preflightRuntimeCloudPlatform = preflightRuntimeCloudPlatform;\nfunction getCloudPlatform() {\n    return cloudPlatform;\n}\nexports.getCloudPlatform = getCloudPlatform;\nfunction checkIsInScf() {\n    return process.env.TENCENTCLOUD_RUNENV === 'SCF';\n}\nexports.checkIsInScf = checkIsInScf;\nfunction checkIsInCBR() {\n    // CBR = CLOUDBASE_RUN\n    return !!process.env.CBR_ENV_ID;\n}\nexports.checkIsInCBR = checkIsInCBR;\nconst kSumeruEnvSet = new Set(['formal', 'pre', 'test']);\nfunction checkIsInSumeru() {\n    // SUMERU_ENV=formal | test | pre\n    return kSumeruEnvSet.has(process.env.SUMERU_ENV);\n}\nexports.checkIsInSumeru = checkIsInSumeru;\nasync function checkIsInTencentCloud() {\n    if (process.env.TENCENTCLOUD === 'true') {\n        return true;\n    }\n    return (0, utils_1.isNonEmptyString)(await (0, metadata_1.lookupAppId)());\n}\nexports.checkIsInTencentCloud = checkIsInTencentCloud;\nfunction checkIsInternal() {\n    return checkIsInScf() || checkIsInCBR() || checkIsInSumeru();\n}\nexports.checkIsInternal = checkIsInternal;\nasync function checkIsInternalAsync() {\n    return checkIsInternal() ? await Promise.resolve(true) : await checkIsInTencentCloud();\n}\nexports.checkIsInternalAsync = checkIsInternalAsync;\nasync function getCurrRunEnvTag() {\n    if (checkIsInScf()) {\n        return 'scf';\n    }\n    else if (checkIsInCBR()) {\n        return 'cbr';\n    }\n    else if (checkIsInSumeru()) {\n        return 'sumeru';\n    }\n    else if (await checkIsInTencentCloud()) {\n        return 'tencentcloud';\n    }\n    return 'unknown';\n}\nexports.getCurrRunEnvTag = getCurrRunEnvTag;\n","\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.lookupCredentials = exports.lookupAppId = exports.lookup = exports.isAppId = exports.kMetadataVersions = exports.kSecurityCredentialsPath = exports.kAppIdPath = exports.kMetadataBaseUrl = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\n// 注意：改地址已经不是一定可以访问的了\nexports.kMetadataBaseUrl = 'http://metadata.tencentyun.com';\nexports.kAppIdPath = 'meta-data/app-id';\nexports.kSecurityCredentialsPath = 'meta-data/cam/security-credentials';\nvar kMetadataVersions;\n(function (kMetadataVersions) {\n    kMetadataVersions[\"v20170919\"] = \"2017-09-19\";\n    kMetadataVersions[\"v1.0\"] = \"1.0\";\n    kMetadataVersions[\"latest\"] = \"latest\";\n})(kMetadataVersions = exports.kMetadataVersions || (exports.kMetadataVersions = {}));\nfunction isAppId(appIdStr) {\n    return /^[1-9][0-9]{4,64}$/gim.test(appIdStr);\n}\nexports.isAppId = isAppId;\nasync function lookup(path, options = {}) {\n    const url = `${exports.kMetadataBaseUrl}/${kMetadataVersions.latest}/${path}`;\n    const resp = await axios_1.default.get(url, options);\n    if (resp.status === 200) {\n        return resp.data;\n    }\n    else {\n        throw new Error(`[ERROR] GET ${url} status: ${resp.status}`);\n    }\n}\nexports.lookup = lookup;\nconst metadataCache = {\n    appId: undefined\n};\n/**\n * lookupAppId - 该方法主要用于判断是否在云上环境\n * @returns\n */\nasync function lookupAppId() {\n    if (metadataCache.appId === undefined) {\n        try {\n            // 只有首次会请求且要求快速返回，超时时间很短，DNS无法解析将会超时返回\n            // 在云环境中，这个时间通常在 10ms 内，部分耗时长（30+ms）的情况是 DNS 解析耗时长（27+ms）\n            const appId = await lookup(exports.kAppIdPath, { timeout: 30 });\n            if (isAppId(appId)) {\n                metadataCache.appId = appId;\n            }\n            else {\n                metadataCache.appId = '';\n            }\n        }\n        catch (e) {\n            // ignore\n        }\n    }\n    return metadataCache.appId || '';\n}\nexports.lookupAppId = lookupAppId;\nasync function lookupCredentials(ruleName) {\n    // `${kMetadataBaseUrl}/meta-data/cam/security-credentials/TCB_QcsRole`\n    // 这里设置了一个较短的超时时间，因为这个请求是在云环境中发起的，通常会很快返回\n    return await lookup(`${exports.kSecurityCredentialsPath}/${ruleName}`, { timeout: 200 });\n}\nexports.lookupCredentials = lookupCredentials;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.buildUrl = void 0;\nconst cloudbase_1 = require(\"../cloudbase\");\nconst utils_1 = require(\"./utils\");\nconst tcbcontext_1 = require(\"./tcbcontext\");\n/* eslint-disable complexity */\nfunction buildUrl(options = { isInternal: false }) {\n    // 优先级：用户配置 > 环境变量\n    const region = options.region || process.env.TENCENTCLOUD_REGION || '';\n    // 有地域信息则访问地域级别域名，无地域信息则访问默认域名，默认域名固定解析到上海地域保持兼容\n    const internetRegionEndpoint = region\n        ? `${region}.tcb-api.tencentcloudapi.com`\n        : 'tcb-api.tencentcloudapi.com';\n    const internalRegionEndpoint = region\n        ? `internal.${region}.tcb-api.tencentcloudapi.com`\n        : 'internal.tcb-api.tencentcloudapi.com';\n    // 同地域走内网，跨地域走公网\n    const isSameRegionVisit = region\n        ? region === process.env.TENCENTCLOUD_REGION\n        : true;\n    const endpoint = isSameRegionVisit && (options.isInternal)\n        ? internalRegionEndpoint\n        : internetRegionEndpoint;\n    const envId = options.envId || '';\n    // 注意：特殊环境ID不能拼在请求地址的域名中，所以这里需要特殊处理\n    const envEndpoint = (0, utils_1.isValidEnvFormat)(envId) ? `${envId}.${endpoint}` : endpoint;\n    const protocol = options.isInternal ? 'http' : options.protocol;\n    // 注意：云函数环境下有地域信息，云应用环境下不确定是否有，如果没有，用户必须显式的传入\n    const path = '/admin';\n    const defaultUrl = `${protocol}://${envEndpoint}${path}`;\n    const serverInjectUrl = (0, tcbcontext_1.getServerInjectUrl)();\n    const url = options.serviceUrl || serverInjectUrl || defaultUrl;\n    const seqId = options.seqId;\n    const qs = cloudbase_1.CloudBase.scfContext\n        ? `env=${envId}&seqId=${seqId}&scfRequestId=${cloudbase_1.CloudBase.scfContext.requestId}`\n        : `env=${envId}&seqId=${seqId}`;\n    return url.includes('?') ? `${url}${qs}` : `${url}?${qs}`;\n}\nexports.buildUrl = buildUrl;\n","\n/* eslint-disable @typescript-eslint/naming-convention */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getServerInjectUrl = exports.getTcbContextConfig = exports.getCloudbaseContext = exports.parseContext = void 0;\nconst code_1 = require(\"../const/code\");\nconst utils_1 = require(\"./utils\");\nconst cloudplatform_1 = require(\"./cloudplatform\");\n/**\n * parseContext 解析并校验 Context 格式\n * @param context {IContextParam}\n * @returns\n */\nfunction parseContext(context) {\n    if (typeof context !== 'object') {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_CONTEXT), { message: 'context 必须为对象类型' }));\n    }\n    const parseResult = {};\n    const { memory_limit_in_mb, time_limit_in_ms, request_id, function_version, namespace, function_name, environ, environment } = context;\n    try {\n        parseResult.memoryLimitInMb = memory_limit_in_mb;\n        parseResult.timeLimitIns = time_limit_in_ms;\n        parseResult.requestId = request_id;\n        parseResult.functionVersion = function_version;\n        parseResult.namespace = namespace;\n        parseResult.functionName = function_name;\n        // 存在 environment 为新架构上新字段，可直接JSON.parse字符串，否则为老架构，需特殊处理\n        if (environment) {\n            parseResult.environment = JSON.parse(environment);\n        }\n        else {\n            // TODO: 考虑移除老架构的兼容逻辑\n            // 老架构上存在bug，无法识别value含特殊字符(若允许特殊字符，影响解析，这里特殊处理)\n            const parseEnviron = environ.split(';');\n            const parseEnvironObj = {};\n            // eslint-disable-next-line @typescript-eslint/no-for-in-array\n            for (const i in parseEnviron) {\n                // value含分号影响切割，未找到=均忽略\n                if (parseEnviron[i].includes('=')) {\n                    const equalIndex = parseEnviron[i].indexOf('=');\n                    const key = parseEnviron[i].slice(0, equalIndex);\n                    let value = parseEnviron[i].slice(equalIndex + 1);\n                    // value 含, 为数组\n                    if (value.indexOf(',') >= 0) {\n                        value = value.split(',');\n                    }\n                    parseEnvironObj[key] = value;\n                }\n            }\n            parseResult.environ = parseEnvironObj;\n        }\n    }\n    catch (err) {\n        throw (0, utils_1.E)(Object.assign({}, code_1.ERROR.INVALID_CONTEXT));\n    }\n    return parseResult;\n}\nexports.parseContext = parseContext;\n/**\n * getCloudbaseContext\n * 获取当前函数内的所有环境变量(作为获取变量的统一方法，取值来源 process.env 和 context)\n */\nfunction getCloudbaseContext(context) {\n    if ((0, cloudplatform_1.checkIsInScf)()) {\n        // 云函数环境下，应该包含以下环境变量，如果没有，后续逻辑可能会有问题\n        if (!process.env.TENCENTCLOUD_REGION) {\n            console.error('[TCB][ERROR] missing `TENCENTCLOUD_REGION` environment');\n        }\n        if (!process.env.SCF_NAMESPACE) {\n            console.error('[TCB][ERROR] missing `SCF_NAMESPACE` environment');\n        }\n    }\n    const { TRIGGER_SRC, _SCF_TCB_LOG, SCF_NAMESPACE, TENCENTCLOUD_RUNENV, TENCENTCLOUD_SECRETID, TENCENTCLOUD_SECRETKEY, TENCENTCLOUD_SESSIONTOKEN, WX_CONTEXT_KEYS, WX_TRIGGER_API_TOKEN_V0, WX_CLIENTIP, WX_CLIENTIPV6, TCB_CONTEXT_KEYS, TCB_CONTEXT_CNFG, LOGINTYPE } = process.env;\n    const envFromProcessEnv = {\n        TRIGGER_SRC,\n        _SCF_TCB_LOG,\n        SCF_NAMESPACE,\n        TENCENTCLOUD_RUNENV,\n        TENCENTCLOUD_SECRETID,\n        TENCENTCLOUD_SECRETKEY,\n        TENCENTCLOUD_SESSIONTOKEN,\n        WX_CONTEXT_KEYS,\n        WX_TRIGGER_API_TOKEN_V0,\n        WX_CLIENTIP,\n        WX_CLIENTIPV6,\n        TCB_CONTEXT_KEYS,\n        TCB_CONTEXT_CNFG,\n        LOGINTYPE\n    };\n    let envFromContext = {};\n    if (context) {\n        const { environment, environ } = parseContext(context);\n        envFromContext = environment || environ || {};\n    }\n    // 从TCB_CONTEXT_KEYS 和 WX_CONTEXT_KEYS中解析环境变量 取值优先级为 context > process.env\n    const tcbContextKeys = envFromContext.TCB_CONTEXT_KEYS || TCB_CONTEXT_KEYS;\n    const wxContextKeys = envFromContext.WX_CONTEXT_KEYS || WX_CONTEXT_KEYS;\n    if (tcbContextKeys) {\n        try {\n            const tcbKeysList = tcbContextKeys.split(',');\n            for (const item of tcbKeysList) {\n                envFromProcessEnv[item] = envFromContext[item] || process.env[item];\n            }\n        }\n        catch (e) { }\n    }\n    if (wxContextKeys) {\n        try {\n            const wxKeysList = wxContextKeys.split(',');\n            for (const item of wxKeysList) {\n                envFromProcessEnv[item] = envFromContext[item] || process.env[item];\n            }\n        }\n        catch (e) { }\n    }\n    const allContext = Object.assign(Object.assign({}, envFromProcessEnv), envFromContext);\n    const finalContext = {};\n    for (const key in allContext) {\n        if (allContext[key] !== undefined) {\n            finalContext[key] = allContext[key];\n        }\n    }\n    return finalContext;\n}\nexports.getCloudbaseContext = getCloudbaseContext;\nfunction getTcbContextConfig() {\n    try {\n        const { TCB_CONTEXT_CNFG } = getCloudbaseContext();\n        if (TCB_CONTEXT_CNFG) {\n            // 检查约定环境变量字段是否存在\n            return JSON.parse(TCB_CONTEXT_CNFG);\n        }\n        return {};\n    }\n    catch (e) {\n        /* istanbul ignore next */\n        console.error('[TCB][ERROR] parse context error: ', e);\n        /* istanbul ignore next */\n        return {};\n    }\n}\nexports.getTcbContextConfig = getTcbContextConfig;\nfunction getServerInjectUrl() {\n    const tcbContextConfig = getTcbContextConfig();\n    return tcbContextConfig.URL || '';\n}\nexports.getServerInjectUrl = getServerInjectUrl;\n","\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.extraRequest = exports.requestWithTimingsMeasure = void 0;\nconst http_1 = __importDefault(require(\"http\"));\nconst retry_1 = require(\"./retry\");\nconst request_timings_measurer_1 = require(\"./request-timings-measurer\");\nconst request_core_1 = require(\"./request-core\");\nconst SAFE_RETRY_CODE_SET = new Set([\n    'ENOTFOUND',\n    'ENETDOWN',\n    'EHOSTDOWN',\n    'ENETUNREACH',\n    'EHOSTUNREACH',\n    'ECONNREFUSED'\n]);\n// const RETRY_CODE_SET = new Set(['ECONNRESET', 'ESOCKETTIMEDOUT'])\nconst RETRY_STATUS_CODE_SET = new Set([]);\n/* istanbul ignore next */\nfunction shouldRetry(e, result, operation) {\n    // 重试的错误码\n    if (e && SAFE_RETRY_CODE_SET.has(e.code)) {\n        return {\n            retryAble: true,\n            message: e.message\n        };\n    }\n    // 连接超时\n    if (e && e.code === 'ETIMEDOUT' && e.connecting === true) {\n        return {\n            retryAble: true,\n            message: e.message\n        };\n    }\n    // 重试的状态码\n    if (result && RETRY_STATUS_CODE_SET.has(result.statusCode)) {\n        return {\n            retryAble: true,\n            message: `${result.request.method} ${result.request.href} ${result.statusCode} ${http_1.default.STATUS_CODES[result.statusCode]}`\n        };\n    }\n    return {\n        retryAble: false,\n        message: ''\n    };\n}\n/* istanbul ignore next */\nasync function requestWithTimingsMeasure(opts, extraOptions) {\n    return await new Promise((resolve, reject) => {\n        const timingsMeasurerOptions = extraOptions.timingsMeasurerOptions || {};\n        const { waitingTime = 1000, interval = 200, enable = !!extraOptions.debug } = timingsMeasurerOptions;\n        const timingsMeasurer = request_timings_measurer_1.RequestTimgingsMeasurer.new({\n            waitingTime,\n            interval,\n            enable\n        });\n        timingsMeasurer.on('progress', (timings, reason = '') => {\n            const timingsLine = `s:${timings.socket || '-'}|l:${timings.lookup\n                || '-'}|c:${timings.connect || '-'}|r:${timings.ready || '-'}|w:${timings.waiting\n                || '-'}|d:${timings.download || '-'}|e:${timings.end || '-'}|E:${timings.error || '-'}`;\n            console.warn(`[TCB][RequestTimgings][${extraOptions.op || ''}] spent ${Date.now()\n                - timings.start}ms(${timingsLine}) [${extraOptions.seqId}][${extraOptions.attempts || 1}][${reason}]`);\n        });\n        (function r() {\n            const cRequest = (0, request_core_1.request)(opts, (err, res, body) => {\n                if (err) {\n                    reject(err);\n                }\n                else {\n                    resolve({\n                        statusCode: res.statusCode,\n                        headers: res.headers,\n                        body\n                    });\n                }\n            });\n            if (cRequest instanceof http_1.default.ClientRequest) {\n                timingsMeasurer.measure(cRequest);\n            }\n        }());\n    });\n}\nexports.requestWithTimingsMeasure = requestWithTimingsMeasure;\nasync function extraRequest(opts, extraOptions) {\n    if (extraOptions && extraOptions.retryOptions) {\n        return await (0, retry_1.withRetry)(async (attempts) => {\n            return await requestWithTimingsMeasure(opts, Object.assign(Object.assign({}, extraOptions), { attempts }));\n        }, Object.assign({ shouldRetry }, extraOptions.retryOptions));\n    }\n    else {\n        return await requestWithTimingsMeasure(opts, Object.assign(Object.assign({}, extraOptions), { attempts: 1 }));\n    }\n}\nexports.extraRequest = extraRequest;\n","\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withRetry = void 0;\nconst retry_1 = __importDefault(require(\"retry\"));\n// import { RetryOperation } from 'retry/lib/retry_operation'\n/* eslint-disable-next-line */\nconst RetryOperation = require('retry/lib/retry_operation');\n/* istanbul ignore next */\nfunction defaultShouldRetry(e, result) {\n    return { retryAble: false, message: '' };\n}\n/**\n * withRetry 重试封装函数\n * @param fn\n * @param retryOptions\n */\n/* istanbul ignore next */\nasync function withRetry(fn, retryOptions) {\n    // 默认不重试，0 表达未开启的含义，所以直接返回 promise\n    if (!retryOptions || retryOptions.retries === 0) {\n        return await fn();\n    }\n    // 默认重试策略采取指数退避策略，超时时间计算公式及参数可查文档\n    // https://github.com/tim-kos/node-retry/\n    // 自定重试时间：\n    // timeouts: [1000, 2000, 4000, 8000]\n    const timeouts = retryOptions.timeouts\n        ? [...retryOptions.timeouts]\n        : retry_1.default.timeouts(retryOptions);\n    const operation = new RetryOperation(timeouts, {\n        forever: retryOptions.forever,\n        unref: retryOptions.unref,\n        maxRetryTime: retryOptions.maxRetryTime // 重试总的时间，单位毫秒，默认：Infinity\n    });\n    const shouldRetry = retryOptions.shouldRetry || defaultShouldRetry;\n    return await new Promise((resolve, reject) => {\n        const isReadyToRetry = (e, resp, operation) => {\n            // 外层有效识别需要或者能够进行重试\n            // shouldRetry 中可调用 operation.stop 停掉重试，operation.retry 返回 false\n            const { retryAble, message } = shouldRetry(e, resp, operation);\n            const info = {};\n            info.nth = operation.attempts();\n            info.at = new Date();\n            info.message = message;\n            // 双重条件判断是否重试，外层判断满足条件与否，还需判断是否满足再次重试条件\n            const readyToRetry = retryAble && operation.retry(Object.assign({}, info));\n            if (!readyToRetry) {\n                // 如果不准备进行重试，并且尝试不止一次\n                // 最后一个错误记录重试信息\n                const ref = e || resp;\n                if (ref && operation.attempts() > 1) {\n                    ref.attempt = {};\n                    ref.attempt.timeouts = operation._originalTimeouts;\n                    ref.attempt.attempts = operation.attempts();\n                    ref.attempt.errors = operation.errors();\n                    // 如果最后一次因为 !retryAble 而没有进行重试\n                    // ref.attempt.errors 中将缺少最后的这个错误\n                    // ref.attempt.errors 中包含最后一次错误信息\n                    if (!retryAble) {\n                        ref.attempt.errors.push(info);\n                    }\n                }\n            }\n            return readyToRetry;\n        };\n        operation.attempt(async () => {\n            try {\n                const result = await fn(operation.attempts());\n                if (!isReadyToRetry(null, result, operation)) {\n                    resolve(result);\n                }\n            }\n            catch (e) {\n                try {\n                    if (!isReadyToRetry(e, null, operation)) {\n                        reject(e);\n                    }\n                }\n                catch (e) {\n                    reject(e);\n                }\n            }\n        }, retryOptions.timeoutOps);\n    });\n}\nexports.withRetry = withRetry;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RequestTimgingsMeasurer = void 0;\nconst events_1 = require(\"events\");\nclass RequestTimgingsMeasurer extends events_1.EventEmitter {\n    static new(options) {\n        return new RequestTimgingsMeasurer(options);\n    }\n    constructor(options) {\n        super();\n        this.e = null;\n        this.timings = {\n        // start: 0,\n        // lookup: -1,\n        // connect: -1,\n        // ready: -1,\n        // waiting: -1,\n        // download: -1,\n        // end: -1\n        };\n        this.e = null;\n        this.enable = options.enable === true;\n        this.timerStarted = false;\n        this.intervalId = null;\n        this.timeoutId = null;\n        this.waitingTime = options.waitingTime || 1000;\n        this.interval = options.interval || 200;\n    }\n    /* istanbul ignore next */\n    measure(clientRequest) {\n        if (!this.enable) {\n            return;\n        }\n        this.startTimer();\n        const timings = this.timings;\n        timings.start = Date.now();\n        clientRequest\n            .once('response', message => {\n            timings.response = Date.now();\n            timings.waiting = Date.now() - timings.start;\n            message.once('end', () => {\n                timings.socket = timings.socket || 0;\n                // timings.lookup = timings.lookup || timings.socket\n                // timings.connect = timings.connect || timings.lookup\n                timings.download = Date.now() - timings.response;\n                timings.end = Date.now() - timings.start;\n                this.stopTimer('end');\n            });\n        })\n            .once('socket', socket => {\n            timings.socket = Date.now() - timings.start;\n            const onlookup = () => {\n                this.timings.lookup = Date.now() - this.timings.start;\n            };\n            const onconnect = () => {\n                this.timings.connect = Date.now() - this.timings.start;\n            };\n            const onready = () => {\n                this.timings.ready = Date.now() - this.timings.start;\n            };\n            if (socket.connecting) {\n                socket.once('lookup', onlookup);\n                socket.once('connect', onconnect);\n                socket.once('ready', onready);\n                socket.once('error', e => {\n                    socket.off('lookup', onlookup);\n                    socket.off('connect', onconnect);\n                    socket.off('ready', onready);\n                    this.e = e;\n                    this.timings.error = Date.now() - this.timings.start;\n                    this.stopTimer(`ee:${e.message}`);\n                });\n            }\n            else {\n                this.timings.lookup = -1;\n                this.timings.connect = -1;\n                this.timings.ready = -1;\n            }\n            // socket.once('data', () => {})\n            // socket.once('drain', () => {})\n            // socket.once('end', () => {\n            //   this.stopTimer('end')\n            // })\n            // socket.once('timeout', () => {\n            //   this.timings.timeout = Date.now() - this.timings.start\n            // })\n        })\n            .once('error', (e) => {\n            this.stopTimer(`ee:${e.message}`);\n        });\n    }\n    /* istanbul ignore next */\n    startTimer() {\n        if (!this.enable) {\n            return;\n        }\n        if (this.timerStarted) {\n            return;\n        }\n        this.timerStarted = true;\n        this.intervalId = null;\n        this.timeoutId = setTimeout(() => {\n            this.process('inprogress');\n            this.intervalId = setInterval(() => {\n                this.process('inprogress');\n            }, this.interval);\n        }, this.waitingTime);\n    }\n    /* istanbul ignore next */\n    stopTimer(reason) {\n        // if (!this.enable) {\n        //   return\n        // }\n        // if (!this.timerStarted) {\n        //   return\n        // }\n        this.timerStarted = false;\n        clearTimeout(this.timeoutId);\n        clearInterval(this.intervalId);\n        this.process(reason);\n    }\n    /* istanbul ignore next */\n    process(reason) {\n        this.emit('progress', Object.assign({}, this.timings), reason);\n    }\n}\nexports.RequestTimgingsMeasurer = RequestTimgingsMeasurer;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.request = void 0;\nconst http_1 = __importDefault(require(\"http\"));\nconst https_1 = __importDefault(require(\"https\"));\nconst agentkeepalive_1 = __importStar(require(\"agentkeepalive\"));\nconst https_proxy_agent_1 = require(\"https-proxy-agent\");\nconst http_proxy_agent_1 = require(\"http-proxy-agent\");\nconst form_data_1 = __importDefault(require(\"form-data\"));\nconst kAgentCache = new Map();\n/**\n * selectAgent\n *\n * 注意：当前不支持 keepalive & proxy 同时配置，如果同时配置，proxy 优先级更高\n *\n * @param url\n * @param options\n * @returns\n */\nfunction selectAgent(url, options) {\n    // 开 keepalive 或 proxy 才需要 agent\n    if (!options.keepalive && !options.proxy) {\n        return null;\n    }\n    const isHttps = url.startsWith('https');\n    const cacheKey = `protocol=${isHttps ? 'https' : 'http'}timeout=${options.timeout}|keepalive${options.keepalive}|proxy=${options.proxy}`;\n    if (kAgentCache && kAgentCache.has(cacheKey)) {\n        return kAgentCache.get(cacheKey);\n    }\n    let agent = isHttps\n        ? https_1.default.globalAgent\n        : http_1.default.globalAgent;\n    if (options.keepalive) {\n        const keepAliveOpts = {\n            keepAliveMsecs: 3000,\n            maxSockets: 100,\n            maxFreeSockets: 10,\n            freeSocketTimeout: 4800,\n            // timeout: options.timeout,\n            socketActiveTTL: null\n        };\n        agent = isHttps\n            ? new agentkeepalive_1.HttpsAgent(Object.assign({}, keepAliveOpts))\n            : new agentkeepalive_1.default(Object.assign({}, keepAliveOpts));\n    }\n    // 当前需兼容 node.js 12，http(s) proxy agent 最高版本为5，不支持传入 agent\n    // 副作用：有 proxy 时，指定 keepalive 无效。由于 proxy 一般调试使用，可以接受\n    if (options.proxy) {\n        const { protocol, hostname, port } = new URL(options.proxy);\n        agent = isHttps\n            ? new https_proxy_agent_1.HttpsProxyAgent({ protocol, host: hostname, port: Number(port), timeout: options.timeout })\n            : new http_proxy_agent_1.HttpProxyAgent({ protocol, host: hostname, port: Number(port), timeout: options.timeout });\n    }\n    if (kAgentCache && agent) {\n        kAgentCache.set(cacheKey, agent);\n    }\n    return agent;\n}\nfunction buildHttpRequestInfo(opts) {\n    // NOTE: 仅某些 method 携带 body 这里仅简单处理\n    if (opts.formData) {\n        const formdata = new form_data_1.default();\n        for (const key in opts.formData) {\n            if (Object.prototype.hasOwnProperty.call(opts.formData, key)) {\n                formdata.append(key, opts.formData[key]);\n            }\n        }\n        return {\n            headers: formdata.getHeaders(),\n            body: formdata.getBuffer()\n        };\n    }\n    else {\n        if (opts.body === undefined || opts.body === null) {\n            return {\n                headers: {}\n            };\n        }\n        const body = JSON.stringify(opts.body);\n        return {\n            headers: { 'content-length': Buffer.byteLength(body, 'utf8') },\n            body\n        };\n    }\n}\nasync function onResponse(res, { encoding, type = 'json' }) {\n    if (type === 'stream') {\n        return await Promise.resolve(undefined);\n    }\n    // rawStream: 返回原始的 Node.js 流，用于真正的流式处理\n    if (type === 'rawStream') {\n        return await Promise.resolve(res);\n    }\n    if (encoding) {\n        res.setEncoding(encoding);\n    }\n    return await new Promise((resolve, reject) => {\n        const bufs = [];\n        res.on('data', (chunk) => {\n            bufs.push(chunk);\n        });\n        res.on('end', () => {\n            const buf = Buffer.concat(bufs);\n            if (type === 'json') {\n                try {\n                    if (buf.byteLength === 0) {\n                        resolve(undefined);\n                        return;\n                    }\n                    resolve(JSON.parse(buf.toString()));\n                }\n                catch (e) {\n                    reject(e);\n                }\n            }\n            resolve(buf);\n        });\n        res.on('error', (err) => {\n            reject(err);\n        });\n    });\n}\nfunction onTimeout(req, cb) {\n    let hasConnected = false;\n    req.once('socket', (socket) => {\n        // NOTE: reusedSocket 为 true 时，不会触发 connect 事件\n        if (req.reusedSocket) {\n            hasConnected = true;\n        }\n        else {\n            socket.once('connect', () => {\n                hasConnected = true;\n            });\n        }\n    });\n    req.on('timeout', () => {\n        // request.reusedSocket\n        // https://nodejs.org/api/net.html#socketconnecting\n        // code 遵循 request 库定义：\n        // ·ETIMEDOUT：connection timeouts，建立连接时发生超时\n        // ·ESOCKETTIMEDOUT：read timeouts，已经成功连接到服务器，等待响应超时\n        // https://github.com/request/request#timeouts\n        const err = new Error(hasConnected ? 'request timeout' : 'connect timeout');\n        err.code = hasConnected ? 'ESOCKETTIMEDOUT' : 'ETIMEDOUT';\n        err.reusedSocket = req.reusedSocket;\n        err.hasConnected = hasConnected;\n        err.connecting = req.socket.connecting;\n        err.url = `${req.protocol}://${req.host}${req.path}`;\n        cb(err);\n    });\n}\nfunction request(opts, cb) {\n    var _a;\n    const times = opts.times || 1;\n    const options = {\n        method: opts.method,\n        headers: opts.headers,\n        timeout: opts.timeout || 1\n    };\n    const { headers, body } = buildHttpRequestInfo(opts);\n    options.headers = Object.assign(Object.assign({}, options.headers), headers);\n    options.agent = options.agent\n        ? options.agent\n        : selectAgent(opts.url, {\n            timeout: opts.timeout,\n            keepalive: opts.keepalive,\n            proxy: opts.proxy\n        });\n    const isHttps = (_a = opts.url) === null || _a === void 0 ? void 0 : _a.startsWith('https');\n    const req = (isHttps ? https_1.default : http_1.default).request(opts.url, options, (res) => {\n        onResponse(res, {\n            encoding: opts.encoding,\n            type: opts.json ? 'json' : opts.type\n        })\n            .then((body) => {\n            cb(null, res, body);\n        })\n            .catch((err) => {\n            cb(err);\n        });\n    });\n    req.on('abort', () => {\n        cb(new Error('request aborted by client'));\n    });\n    req.on('error', (err) => {\n        if (err && opts.debug) {\n            console.warn(`[TCB][RequestTimgings][keepalive:${opts.keepalive}][reusedSocket:${req === null || req === void 0 ? void 0 : req.reusedSocket}][code:${err.code}][message:${err.message}]${opts.url}`);\n        }\n        if ((err === null || err === void 0 ? void 0 : err.code) === 'ECONNRESET' && (req === null || req === void 0 ? void 0 : req.reusedSocket) && opts.keepalive && opts.times >= 0) {\n            return request(Object.assign(Object.assign({}, opts), { times: times - 1 }), cb);\n        }\n        cb(err);\n    });\n    if (typeof opts.timeout === 'number' && opts.timeout >= 0) {\n        onTimeout(req, cb);\n        req.setTimeout(opts.timeout);\n    }\n    // NOTE: 未传 body 时，不调用 write&end 方法，由外部调用，通常是 pipe 调用\n    if (body) {\n        req.write(body);\n        req.end();\n    }\n    else {\n        // 如果显式指明 noBody 则直接调用 end\n        if (opts.noBody) {\n            req.end();\n        }\n    }\n    // NOTE: http(s).request 需手动调用 end 方法\n    if (options.method.toLowerCase() === 'get') {\n        req.end();\n    }\n    return req;\n}\nexports.request = request;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.loadWxCloudbaseAccesstoken = exports.getWxCloudToken = exports.CLOUDBASE_ACCESS_TOKEN_PATH = void 0;\n// 由定时触发器触发时（TRIGGER_SRC=timer）：优先使用 WX_TRIGGER_API_TOKEN_V0，不存在的话，为了兼容兼容旧的开发者工具，也是使用 WX_API_TOKEN\n// 非定时触发器触发时（TRIGGER_SRC!=timer）: 使用 WX_API_TOKEN\nconst fs = __importStar(require(\"fs\"));\nconst cloudbase_1 = require(\"../cloudbase\");\nconst cloudplatform_1 = require(\"./cloudplatform\");\nexports.CLOUDBASE_ACCESS_TOKEN_PATH = '/.tencentcloudbase/wx/cloudbase_access_token';\nfunction getWxCloudToken() {\n    const { TRIGGER_SRC, WX_TRIGGER_API_TOKEN_V0, WX_API_TOKEN, WX_CLOUDBASE_ACCESSTOKEN = '' } = cloudbase_1.CloudBase.getCloudbaseContext();\n    const wxCloudToken = {};\n    if (TRIGGER_SRC === 'timer') {\n        wxCloudToken.wxCloudApiToken = WX_TRIGGER_API_TOKEN_V0 || WX_API_TOKEN || '';\n    }\n    else {\n        wxCloudToken.wxCloudApiToken = WX_API_TOKEN || '';\n    }\n    // 只在不存在 wxCloudApiToken 时，才尝试读取 wxCloudbaseAccesstoken\n    if (!wxCloudToken.wxCloudApiToken) {\n        wxCloudToken.wxCloudbaseAccesstoken = WX_CLOUDBASE_ACCESSTOKEN || loadWxCloudbaseAccesstoken();\n    }\n    return wxCloudToken;\n}\nexports.getWxCloudToken = getWxCloudToken;\nconst maxCacheAge = 10 * 60 * 1000;\nconst cloudbaseAccessTokenInfo = { token: '', timestamp: 0 };\nfunction loadWxCloudbaseAccesstoken() {\n    if (cloudbaseAccessTokenInfo.token && Date.now() - cloudbaseAccessTokenInfo.timestamp < maxCacheAge) {\n        return cloudbaseAccessTokenInfo.token;\n    }\n    try {\n        if ((0, cloudplatform_1.checkIsInCBR)() && fs.existsSync(exports.CLOUDBASE_ACCESS_TOKEN_PATH)) {\n            cloudbaseAccessTokenInfo.token = fs.readFileSync(exports.CLOUDBASE_ACCESS_TOKEN_PATH).toString();\n            cloudbaseAccessTokenInfo.timestamp = Date.now();\n            return cloudbaseAccessTokenInfo.token;\n        }\n    }\n    catch (e) {\n        console.warn('[TCB][ERROR]: loadWxCloudbaseAccesstoken error: ', e.message);\n    }\n    return '';\n}\nexports.loadWxCloudbaseAccesstoken = loadWxCloudbaseAccesstoken;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.version = void 0;\nconst fs = __importStar(require(\"fs\"));\nconst path = __importStar(require(\"path\"));\nfunction loadPackage() {\n    try {\n        return JSON.parse(fs.readFileSync(path.join(__dirname, '../../package.json')).toString());\n    }\n    catch (e) {\n        // 某些场景下可能无法成功加载到 package.json 文件\n    }\n    return {\n        version: 'unknow'\n    };\n}\nexports.version = loadPackage().version;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.request = exports.TcbOpenApiHttpCommonRequester = exports.getEnvIdFromContext = void 0;\n/* eslint-disable-next-line */\nconst url_1 = require(\"url\");\nconst signature_nodejs_1 = require(\"@cloudbase/signature-nodejs\");\nconst cloudbase_1 = require(\"../cloudbase\");\nconst tracing_1 = require(\"./tracing\");\nconst cloudplatform_1 = require(\"./cloudplatform\");\nconst tcbapirequester_1 = require(\"./tcbapirequester\");\nconst symbol_1 = require(\"../const/symbol\");\nconst request_1 = require(\"./request\");\nconst version_1 = require(\"./version\");\nconst utils = __importStar(require(\"./utils\"));\nconst tcbopenapiendpoint_1 = require(\"./tcbopenapiendpoint\");\nconst { second } = utils;\nfunction getEnvIdFromContext() {\n    const { TCB_ENV, SCF_NAMESPACE } = cloudbase_1.CloudBase.getCloudbaseContext();\n    return TCB_ENV || SCF_NAMESPACE || '';\n}\nexports.getEnvIdFromContext = getEnvIdFromContext;\nclass TcbOpenApiHttpCommonRequester {\n    /* eslint-enable no-undef */\n    constructor(args) {\n        var _a, _b;\n        this.defaultTimeout = 15000;\n        this.timestamp = new Date().valueOf();\n        /* eslint-disable no-undef */\n        this.slowWarnTimer = null;\n        this.args = args;\n        this.config = args.config;\n        this.opts = args.opts || {};\n        this.tracingInfo = (0, tracing_1.generateTracingInfo)((_b = (_a = args.config) === null || _a === void 0 ? void 0 : _a.context) === null || _b === void 0 ? void 0 : _b.eventID);\n    }\n    async request() {\n        await this.prepareCredentials();\n        const opts = this.makeReqOpts();\n        const argopts = this.opts;\n        const config = this.config;\n        // 注意：必须初始化为 null\n        let retryOptions = null;\n        if (argopts.retryOptions) {\n            retryOptions = argopts.retryOptions;\n        }\n        else if (config.retries && typeof config.retries === 'number') {\n            retryOptions = { retries: config.retries };\n        }\n        return await (0, request_1.extraRequest)(opts, {\n            debug: config.debug,\n            op: `${opts.method}:${opts.url}`,\n            seqId: this.tracingInfo.seqId,\n            retryOptions,\n            timingsMeasurerOptions: config.timingsMeasurerOptions || {}\n        }).then((response) => {\n            this.slowWarnTimer && clearTimeout(this.slowWarnTimer);\n            return response;\n        });\n    }\n    makeReqOpts() {\n        var _a, _b;\n        const config = this.config;\n        const args = this.args;\n        const envId = args.config.envName === symbol_1.SYMBOL_CURRENT_ENV\n            ? getEnvIdFromContext()\n            : args.config.envName;\n        const url = args.url || (0, tcbopenapiendpoint_1.buildCommonOpenApiUrlWithPath)({\n            envId,\n            path: args.path,\n            region: config.region\n        });\n        const timeout = ((_a = this.args.opts) === null || _a === void 0 ? void 0 : _a.timeout) || this.config.timeout || this.defaultTimeout;\n        const opts = {\n            url,\n            method: args.method,\n            timeout,\n            headers: this.buildHeaders(args.method, url),\n            proxy: config.proxy\n        };\n        if (typeof config.keepalive === 'undefined' && !(0, cloudplatform_1.checkIsInScf)()) {\n            // 非云函数环境下，默认开启 keepalive\n            opts.keepalive = true;\n        }\n        else {\n            /** eslint-disable-next-line */\n            opts.keepalive = typeof config.keepalive === 'boolean' && config.keepalive;\n        }\n        if (args.data) {\n            if (['post', 'put', 'patch', 'delete'].includes(args.method.toLowerCase())) {\n                if (args.isFormData) {\n                    opts.formData = args.data;\n                    opts.encoding = null;\n                }\n                else {\n                    opts.body = args.data;\n                    if (((_b = args.opts) === null || _b === void 0 ? void 0 : _b.stream) !== true) {\n                        opts.json = true;\n                    }\n                    else {\n                        // 使用 rawStream 类型返回原始的 Node.js 流，实现真正的流式响应\n                        opts.type = 'rawStream';\n                    }\n                }\n            }\n            else {\n                /* istanbul ignore next */\n                opts.qs = args.data;\n            }\n        }\n        else {\n            opts.noBody = true;\n        }\n        return opts;\n    }\n    async prepareCredentials() {\n        tcbapirequester_1.prepareCredentials.bind(this)();\n    }\n    buildHeaders(method, url) {\n        var _a;\n        const config = this.config;\n        const { context, secretId, secretKey, sessionToken } = config;\n        const args = this.args;\n        const { TCB_SOURCE } = cloudbase_1.CloudBase.getCloudbaseContext();\n        // Note: 云函数被调用时可能调用端未传递 SOURCE，TCB_SOURCE 可能为空\n        const SOURCE = `${((_a = context === null || context === void 0 ? void 0 : context.extendedContext) === null || _a === void 0 ? void 0 : _a.source) || TCB_SOURCE || ''},${args.opts.runEnvTag}`;\n        // 注意：因为 url.parse 和 url.URL 存在差异，因 url.parse 已被废弃，这里可能会需要改动。\n        // 因 @cloudbase/signature-nodejs sign 方法目前内部使用 url.parse 解析 url，\n        // 如果这里需要改动，需要注意与 @cloudbase/signature-nodejs 的兼容性\n        // 否则将导致签名存在问题\n        const parsedUrl = (0, url_1.parse)(url);\n        // const parsedUrl = new URL(url)\n        let requiredHeaders = {\n            'User-Agent': `tcb-node-sdk/${version_1.version}`,\n            'X-TCB-Source': SOURCE,\n            'X-Client-Timestamp': this.timestamp,\n            'X-SDK-Version': `tcb-node-sdk/${version_1.version}`,\n            Host: parsedUrl.host\n        };\n        if (config.version) {\n            requiredHeaders['X-SDK-Version'] = config.version;\n        }\n        if (this.tracingInfo.trace) {\n            requiredHeaders['X-TCB-Tracelog'] = this.tracingInfo.trace;\n        }\n        const region = this.config.region || process.env.TENCENTCLOUD_REGION || '';\n        if (region) {\n            requiredHeaders['X-TCB-Region'] = region;\n        }\n        requiredHeaders = Object.assign(Object.assign(Object.assign({}, config.headers), args.headers), requiredHeaders);\n        // TODO: 升级SDK版本，否则没传 args.data 时会签名失败\n        const { authorization, timestamp } = (0, signature_nodejs_1.sign)({\n            secretId,\n            secretKey,\n            method,\n            url,\n            params: args.data || '',\n            headers: requiredHeaders,\n            timestamp: second() - 1,\n            withSignedParams: false,\n            isCloudApi: true\n        });\n        /* eslint-disable @typescript-eslint/dot-notation */\n        requiredHeaders['Authorization'] = args.token\n            ? makeBearerToken(args.token)\n            : typeof sessionToken === 'string' && sessionToken !== ''\n                ? `${authorization}, Timestamp=${timestamp}, Token=${sessionToken}`\n                : `${authorization}, Timestamp=${timestamp}`;\n        return Object.assign({}, requiredHeaders);\n    }\n}\nexports.TcbOpenApiHttpCommonRequester = TcbOpenApiHttpCommonRequester;\nasync function request(args) {\n    if (typeof args.isInternal === 'undefined') {\n        args.isInternal = await (0, cloudplatform_1.checkIsInternalAsync)();\n    }\n    args.opts = args.opts || {};\n    args.opts.runEnvTag = await (0, cloudplatform_1.getCurrRunEnvTag)();\n    const requester = new TcbOpenApiHttpCommonRequester(args);\n    return await requester.request();\n}\nexports.request = request;\nfunction makeBearerToken(token) {\n    const trimmed = token.trim();\n    return trimmed.startsWith('Bearer ') ? trimmed : `Bearer ${trimmed}`;\n}\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.buildCommonOpenApiUrlWithPath = exports.buildUrl = void 0;\nconst ZONE_CHINA = ['ap-shanghai', 'ap-guangzhou', 'ap-shenzhen-fsi', 'ap-shanghai-fsi', 'ap-nanjing', 'ap-beijing', 'ap-chengdu', 'ap-chongqing', 'ap-hongkong'];\n/* eslint-disable complexity */\nfunction buildUrl(options) {\n    const endpoint = `https://${getGatewayUrl(options)}/v1/cloudrun/${options.name}`;\n    const path = options.path.startsWith('/') ? options.path : `/${options.path}`;\n    return `${endpoint}${path}`;\n}\nexports.buildUrl = buildUrl;\nfunction buildCommonOpenApiUrlWithPath(options) {\n    return `${options.protocol || 'https'}://${options.serviceUrl || getGatewayUrl(options)}${options.path}`;\n}\nexports.buildCommonOpenApiUrlWithPath = buildCommonOpenApiUrlWithPath;\nfunction getGatewayUrl(options) {\n    const region = options.region || 'ap-shanghai';\n    let baseUrl = `${options.envId}.api.tcloudbasegateway.com`;\n    if (!ZONE_CHINA.includes(region)) {\n        baseUrl = `${options.envId}.api.intl.tcloudbasegateway.com`;\n    }\n    return baseUrl;\n}\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.callApis = exports.callFunction = void 0;\nconst tcbapicaller = __importStar(require(\"../utils/tcbapirequester\"));\nconst tcbopenapicommonrequester = __importStar(require(\"../utils/tcbopenapicommonrequester\"));\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst cloudbase_1 = require(\"../cloudbase\");\nconst cloudrun_1 = require(\"../cloudrun\");\nasync function callFunction(cloudbase, callFunctionOptions, opts) {\n    // cloudrunfunctions\n    if (callFunctionOptions.type === 'cloudrun') {\n        const resp = await (0, cloudrun_1.callContainer)(cloudbase, callFunctionOptions, opts);\n        return {\n            requestId: resp.requestId,\n            result: resp.data\n        };\n    }\n    // cloudfunctions\n    const { name, qualifier, data } = callFunctionOptions;\n    const { TCB_ROUTE_KEY } = cloudbase_1.CloudBase.getCloudbaseContext();\n    let transformData;\n    try {\n        transformData = data ? JSON.stringify(data) : '';\n    }\n    catch (e) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, e), { code: code_1.ERROR.INVALID_PARAM.code, message: '对象出现了循环引用' }));\n    }\n    if (!name) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '函数名不能为空' }));\n    }\n    const params = {\n        action: 'functions.invokeFunction',\n        function_name: name,\n        qualifier,\n        // async: async,\n        request_data: transformData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: Object.assign({ 'content-type': 'application/json' }, (TCB_ROUTE_KEY ? { 'X-TCB-Route-Key': TCB_ROUTE_KEY } : {}))\n    }).then(res => {\n        if (res.code) {\n            return res;\n        }\n        let result;\n        try {\n            result = JSON.parse(res.data.response_data);\n        }\n        catch (e) {\n            result = res.data.response_data;\n        }\n        return {\n            result,\n            requestId: res.requestId\n        };\n    });\n}\nexports.callFunction = callFunction;\n/**\n * 直接调用apis接口\n * @param cloudbase\n * @param callApiOptions\n * @param opts\n * @returns\n */\nasync function callApis(cloudbase, callApiOptions, opts) {\n    let { name, body, path = '', method = 'POST', header = {}, token = '' } = callApiOptions;\n    if (!name) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'invalid api name' }));\n    }\n    let data = body;\n    method = method || 'POST';\n    const contentType = (header === null || header === void 0 ? void 0 : header['Content-Type']) || (header === null || header === void 0 ? void 0 : header['content-type']) || 'application/json; charset=utf-8';\n    try {\n        if (method.toLocaleLowerCase() === 'post' && contentType.toLocaleLowerCase().includes('application/json')) {\n            data = JSON.parse(body);\n        }\n    }\n    catch (error) {\n        data = body;\n    }\n    return await tcbopenapicommonrequester.request({\n        config: cloudbase.config,\n        path: `/v1/apis/${name}${path.startsWith('/') ? path : `/${path}`}`,\n        method,\n        headers: Object.assign({ 'Content-Type': contentType }, header),\n        data,\n        token,\n        opts\n    });\n}\nexports.callApis = callApis;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.callContainer = void 0;\nconst tcbopenapirequester = __importStar(require(\"../utils/tcbopenapirequester\"));\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nasync function callContainer(cloudbase, callContainerOptions, opts) {\n    // 这里先不对齐了，代码先保留\n    // if (callContainerOptions.header && callContainerOptions.header['X-WX-SERVICE'] !== '') {\n    //   if (!callContainerOptions.name) {\n    //     callContainerOptions.name = callContainerOptions.header['X-WX-SERVICE']\n    //   }\n    //   if (callContainerOptions.header['X-WX-SERVICE'] !== callContainerOptions.name) {\n    //     throw E({\n    //       ...ERROR.INVALID_PARAM,\n    //       message: '服务名冲突'\n    //     })\n    //   }\n    // }\n    const { name, data } = callContainerOptions;\n    if (!name) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '服务名不能为空' }));\n    }\n    return await tcbopenapirequester.request({\n        cloudrun: { name },\n        config: cloudbase.config,\n        method: callContainerOptions.method || 'POST',\n        path: callContainerOptions.path || '',\n        headers: Object.assign({}, {\n            'Content-Type': 'application/json; charset=utf-8'\n        }, callContainerOptions.header),\n        data,\n        opts\n    }).then(resp => {\n        try {\n            resp.data = typeof resp.body === 'string' ? JSON.parse(resp.body) : resp.body;\n        }\n        catch (e) {\n            // ignore\n        }\n        return {\n            requestId: resp.headers['x-request-id'] || resp.headers['x-cloudbase-request-id'],\n            statusCode: resp.statusCode,\n            header: resp.headers,\n            data: resp.data\n        };\n    });\n}\nexports.callContainer = callContainer;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.request = exports.TcbOpenApiHttpRequester = exports.getEnvIdFromContext = void 0;\n/* eslint-disable-next-line */\nconst url_1 = require(\"url\");\nconst signature_nodejs_1 = require(\"@cloudbase/signature-nodejs\");\nconst symbol_1 = require(\"../const/symbol\");\nconst cloudbase_1 = require(\"../cloudbase\");\nconst tracing_1 = require(\"./tracing\");\nconst cloudplatform_1 = require(\"./cloudplatform\");\nconst tcbopenapiendpoint_1 = require(\"./tcbopenapiendpoint\");\nconst tcbapirequester_1 = require(\"./tcbapirequester\");\nconst request_1 = require(\"./request\");\nconst version_1 = require(\"./version\");\nconst utils = __importStar(require(\"./utils\"));\nconst { second } = utils;\nfunction getEnvIdFromContext() {\n    const { TCB_ENV, SCF_NAMESPACE } = cloudbase_1.CloudBase.getCloudbaseContext();\n    return TCB_ENV || SCF_NAMESPACE || '';\n}\nexports.getEnvIdFromContext = getEnvIdFromContext;\nclass TcbOpenApiHttpRequester {\n    /* eslint-enable no-undef */\n    constructor(args) {\n        var _a, _b;\n        this.defaultTimeout = 15000;\n        this.timestamp = new Date().valueOf();\n        /* eslint-disable no-undef */\n        this.slowWarnTimer = null;\n        this.args = args;\n        this.config = args.config;\n        this.opts = args.opts || {};\n        this.tracingInfo = (0, tracing_1.generateTracingInfo)((_b = (_a = args.config) === null || _a === void 0 ? void 0 : _a.context) === null || _b === void 0 ? void 0 : _b.eventID);\n    }\n    async request() {\n        await this.prepareCredentials();\n        const opts = this.makeReqOpts();\n        const argopts = this.opts;\n        const config = this.config;\n        // 注意：必须初始化为 null\n        let retryOptions = null;\n        if (argopts.retryOptions) {\n            retryOptions = argopts.retryOptions;\n        }\n        else if (config.retries && typeof config.retries === 'number') {\n            retryOptions = { retries: config.retries };\n        }\n        return await (0, request_1.extraRequest)(opts, {\n            debug: config.debug,\n            op: `${opts.method}:${opts.url}`,\n            seqId: this.tracingInfo.seqId,\n            retryOptions,\n            timingsMeasurerOptions: config.timingsMeasurerOptions || {}\n        }).then((response) => {\n            this.slowWarnTimer && clearTimeout(this.slowWarnTimer);\n            return response;\n        });\n    }\n    makeReqOpts() {\n        var _a;\n        const config = this.config;\n        const args = this.args;\n        const envId = args.config.envName === symbol_1.SYMBOL_CURRENT_ENV\n            ? getEnvIdFromContext()\n            : args.config.envName;\n        const url = (0, tcbopenapiendpoint_1.buildUrl)({\n            envId,\n            region: this.config.region,\n            // protocol: this.config.protocol || 'https',\n            // serviceUrl: this.config.serviceUrl,\n            // seqId: this.tracingInfo.seqId,\n            // isInternal: this.args.isInternal,\n            name: args.cloudrun.name,\n            path: args.path\n        });\n        const timeout = ((_a = this.args.opts) === null || _a === void 0 ? void 0 : _a.timeout) || this.config.timeout || this.defaultTimeout;\n        const opts = {\n            url,\n            method: args.method,\n            timeout,\n            headers: this.buildHeaders(args.method, url),\n            proxy: config.proxy\n        };\n        if (typeof config.keepalive === 'undefined' && !(0, cloudplatform_1.checkIsInScf)()) {\n            // 非云函数环境下，默认开启 keepalive\n            opts.keepalive = true;\n        }\n        else {\n            /** eslint-disable-next-line */\n            opts.keepalive = typeof config.keepalive === 'boolean' && config.keepalive;\n        }\n        if (args.data) {\n            if (args.method.toLowerCase() === 'post') {\n                if (args.isFormData) {\n                    opts.formData = args.data;\n                    opts.encoding = null;\n                }\n                else {\n                    opts.body = args.data;\n                    opts.json = true;\n                }\n            }\n            else {\n                /* istanbul ignore next */\n                // 这里 qs 参数暂时并没使用\n                opts.qs = args.data;\n            }\n        }\n        else {\n            opts.noBody = true;\n        }\n        return opts;\n    }\n    async prepareCredentials() {\n        tcbapirequester_1.prepareCredentials.bind(this)();\n    }\n    buildHeaders(method, url) {\n        var _a;\n        const config = this.config;\n        const { context, secretId, secretKey, sessionToken } = config;\n        const args = this.args;\n        const { TCB_SOURCE } = cloudbase_1.CloudBase.getCloudbaseContext();\n        // Note: 云函数被调用时可能调用端未传递 SOURCE，TCB_SOURCE 可能为空\n        const SOURCE = `${((_a = context === null || context === void 0 ? void 0 : context.extendedContext) === null || _a === void 0 ? void 0 : _a.source) || TCB_SOURCE || ''},${args.opts.runEnvTag}`;\n        // 注意：因为 url.parse 和 url.URL 存在差异，因 url.parse 已被废弃，这里可能会需要改动。\n        // 因 @cloudbase/signature-nodejs sign 方法目前内部使用 url.parse 解析 url，\n        // 如果这里需要改动，需要注意与 @cloudbase/signature-nodejs 的兼容性\n        // 否则将导致签名存在问题\n        const parsedUrl = (0, url_1.parse)(url);\n        // const parsedUrl = new URL(url)\n        let requiredHeaders = {\n            'User-Agent': `tcb-node-sdk/${version_1.version}`,\n            'X-TCB-Source': SOURCE,\n            'X-Client-Timestamp': this.timestamp,\n            'X-SDK-Version': `tcb-node-sdk/${version_1.version}`,\n            Host: parsedUrl.host\n        };\n        if (config.version) {\n            requiredHeaders['X-SDK-Version'] = config.version;\n        }\n        if (this.tracingInfo.trace) {\n            requiredHeaders['X-TCB-Tracelog'] = this.tracingInfo.trace;\n        }\n        const region = this.config.region || process.env.TENCENTCLOUD_REGION || '';\n        if (region) {\n            requiredHeaders['X-TCB-Region'] = region;\n        }\n        requiredHeaders = Object.assign(Object.assign(Object.assign({}, config.headers), args.headers), requiredHeaders);\n        let params = args.data || '';\n        // GET 方法不支持传 BODY\n        if (method.toLowerCase() === 'get') {\n            params = '';\n        }\n        // TODO: 升级SDK版本，否则没传 args.data 时会签名失败\n        const { authorization, timestamp } = (0, signature_nodejs_1.sign)({\n            secretId,\n            secretKey,\n            method,\n            url,\n            params,\n            headers: requiredHeaders,\n            timestamp: second() - 1,\n            withSignedParams: false,\n            isCloudApi: true\n        });\n        /* eslint-disable @typescript-eslint/dot-notation */\n        requiredHeaders['Authorization'] = typeof sessionToken === 'string' && sessionToken !== ''\n            ? `${authorization}, Timestamp=${timestamp}, Token=${sessionToken}`\n            : `${authorization}, Timestamp=${timestamp}`;\n        return Object.assign({}, requiredHeaders);\n    }\n}\nexports.TcbOpenApiHttpRequester = TcbOpenApiHttpRequester;\nasync function request(args) {\n    if (typeof args.isInternal === 'undefined') {\n        args.isInternal = await (0, cloudplatform_1.checkIsInternalAsync)();\n    }\n    args.opts = args.opts || {};\n    args.opts.runEnvTag = await (0, cloudplatform_1.getCurrRunEnvTag)();\n    const requester = new TcbOpenApiHttpRequester(args);\n    return await requester.request();\n}\nexports.request = request;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.newDb = void 0;\nconst database_1 = require(\"@cloudbase/database\");\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst tcbdbapirequester_1 = require(\"../utils/tcbdbapirequester\");\nfunction newDb(cloudbase, dbConfig = {}) {\n    database_1.Db.reqClass = tcbdbapirequester_1.TcbDBApiHttpRequester;\n    // 兼容方法预处理\n    if (Object.prototype.toString.call(dbConfig).slice(8, -1) !== 'Object') {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'dbConfig must be an object' }));\n    }\n    if (dbConfig === null || dbConfig === void 0 ? void 0 : dbConfig.env) {\n        // env变量名转换\n        dbConfig.envName = dbConfig.env;\n        delete dbConfig.env;\n    }\n    return new database_1.Db(Object.assign(Object.assign({}, cloudbase.config), dbConfig));\n}\nexports.newDb = newDb;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TcbDBApiHttpRequester = void 0;\nconst tcbapicaller = __importStar(require(\"./tcbapirequester\"));\nclass TcbDBApiHttpRequester {\n    constructor(config) {\n        this.config = config;\n    }\n    /**\n       * 发送请求\n       *\n       * @param dbParams   - 数据库请求参数\n       * @param opts  - 可选配置项\n       */\n    async send(api, data, opts) {\n        const params = Object.assign(Object.assign({}, data), { action: api });\n        return await tcbapicaller.request({\n            config: this.config,\n            params,\n            method: 'post',\n            opts,\n            headers: {\n                'content-type': 'application/json'\n            }\n        });\n    }\n}\nexports.TcbDBApiHttpRequester = TcbDBApiHttpRequester;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.copyFile = exports.getFileAuthority = exports.getUploadMetadata = exports.downloadFile = exports.getFileInfo = exports.getTempFileURL = exports.deleteFile = exports.uploadFile = void 0;\nconst fs_1 = __importDefault(require(\"fs\"));\nconst path_1 = __importDefault(require(\"path\"));\nconst stream_1 = require(\"stream\");\nconst xml2js_1 = require(\"xml2js\");\nconst tcbapicaller = __importStar(require(\"../utils/tcbapirequester\"));\nconst request_core_1 = require(\"../utils/request-core\");\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst cloudbase_1 = require(\"../cloudbase\");\nasync function parseXML(str) {\n    return await new Promise((resolve, reject) => {\n        (0, xml2js_1.parseString)(str, (err, result) => {\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve(result);\n            }\n        });\n    });\n}\n/**\n * 上传文件\n * @param {string} cloudPath 上传后的文件路径\n * @param {fs.ReadStream | Buffer} fileContent  上传文件的二进制流\n */\nasync function uploadFile(cloudbase, { cloudPath, fileContent }, opts) {\n    if (!(fileContent instanceof fs_1.default.ReadStream) && !(fileContent instanceof Buffer)) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '[node-sdk] fileContent should be instance of fs.ReadStream or Buffer' }));\n    }\n    const { requestId, data: { url, token, authorization, fileId, cosFileId } } = await getUploadMetadata(cloudbase, { cloudPath }, opts);\n    const headers = {\n        Signature: authorization,\n        'x-cos-security-token': token,\n        'x-cos-meta-fileid': cosFileId,\n        authorization,\n        key: encodeURIComponent(cloudPath)\n    };\n    const fileStream = stream_1.Readable.from(fileContent);\n    let body = await new Promise((resolve, reject) => {\n        const req = (0, request_core_1.request)({ method: 'put', url, headers, type: 'raw' }, (err, _, body) => {\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve(body);\n            }\n        });\n        req.on('error', (err) => {\n            reject(err);\n        });\n        // automatically close, no need to call req.end\n        fileStream.pipe(req);\n    });\n    // 成功返回空字符串，失败返回如下格式 XML：\n    // <?xml version='1.0' encoding='utf-8' ?>\n    // <Error>\n    //     <Code>InvalidAccessKeyId</Code>\n    //     <Message>The Access Key Id you provided does not exist in our records</Message>\n    //     <Resource>/path/to/file/key.xyz</Resource>\n    //     <RequestId>NjQzZTMyYzBfODkxNGJlMDlfZjU4NF9hMjk4YTUy</RequestId>\n    //     <TraceId>OGVmYzZiMmQzYjA2OWNhODk0NTRkMTBiOWVmMDAxODc0OWRkZjk0ZDM1NmI1M2E2MTRlY2MzZDhmNmI5MWI1OTQyYWVlY2QwZTk2MDVmZDQ3MmI2Y2I4ZmI5ZmM4ODFjYmRkMmZmNzk1YjUxODZhZmZlNmNhYWUyZTQzYjdiZWY=</TraceId>\n    // </Error>\n    body = await parseXML(body);\n    if (body === null || body === void 0 ? void 0 : body.Error) {\n        const { Code: [code], Message: [message], RequestId: [cosRequestId], TraceId: [cosTraceId] } = body.Error;\n        if (code === 'SignatureDoesNotMatch') {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.SYS_ERR), { message: `[${code}]: ${message}`, requestId: `${requestId}|${cosRequestId}|${cosTraceId}` }));\n        }\n        return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.STORAGE_REQUEST_FAIL), { message: `[${code}]: ${message}`, requestId: `${requestId}|${cosRequestId}|${cosTraceId}` }));\n    }\n    return {\n        fileID: fileId\n    };\n}\nexports.uploadFile = uploadFile;\n/**\n * 删除文件\n * @param {Array.<string>} fileList 文件id数组\n */\nasync function deleteFile(cloudbase, { fileList }, opts) {\n    if (!fileList || !Array.isArray(fileList)) {\n        return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList必须是非空的数组' }));\n    }\n    for (const file of fileList) {\n        if (!file || typeof file !== 'string') {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList的元素必须是非空的字符串' }));\n        }\n    }\n    const params = {\n        action: 'storage.batchDeleteFile',\n        fileid_list: fileList\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    }).then(res => {\n        if (res.code) {\n            return res;\n        }\n        //     throw E({ ...res })\n        // } else {\n        return {\n            fileList: res.data.delete_list,\n            requestId: res.requestId\n        };\n        // }\n    });\n}\nexports.deleteFile = deleteFile;\n/**\n * 获取文件下载链接\n * @param {Array.<Object>} fileList\n */\nasync function getTempFileURL(cloudbase, { fileList }, opts) {\n    if (!fileList || !Array.isArray(fileList)) {\n        return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList必须是非空的数组' }));\n    }\n    /* eslint-disable-next-line @typescript-eslint/naming-convention */\n    const file_list = [];\n    for (const file of fileList) {\n        if (typeof file === 'object') {\n            if (!Object.prototype.hasOwnProperty.call(file, 'fileID')\n                || !Object.prototype.hasOwnProperty.call(file, 'maxAge')) {\n                return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList 的元素如果是对象，必须是包含 fileID 和 maxAge 的对象' }));\n            }\n            file_list.push({\n                fileid: file.fileID,\n                max_age: file.maxAge,\n                url_type: file.urlType\n            });\n        }\n        else if (typeof file === 'string') {\n            file_list.push({\n                fileid: file\n            });\n        }\n        else {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList的元素如果不是对象，则必须是字符串' }));\n        }\n    }\n    const params = {\n        action: 'storage.batchGetDownloadUrl',\n        file_list\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    }).then(res => {\n        if (res.code) {\n            return res;\n        }\n        return {\n            fileList: res.data.download_list,\n            requestId: res.requestId\n        };\n    });\n}\nexports.getTempFileURL = getTempFileURL;\nasync function getFileInfo(cloudbase, { fileList }, opts) {\n    var _a;\n    const fileInfo = await getTempFileURL(cloudbase, { fileList }, opts);\n    if ((fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.fileList) && ((_a = fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.fileList) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n        const fileList = await Promise.all(fileInfo.fileList.map(async (item) => {\n            if (item.code !== 'SUCCESS') {\n                return {\n                    code: item.code,\n                    fileID: item.fileID,\n                    tempFileURL: item.tempFileURL\n                };\n            }\n            try {\n                const res = await fetch(encodeURI(item.tempFileURL), { method: 'HEAD' });\n                const fileSize = parseInt(res.headers.get('content-length')) || 0;\n                const contentType = res.headers.get('content-type') || '';\n                const fileInfo = {\n                    code: item.code,\n                    fileID: item.fileID,\n                    tempFileURL: item.tempFileURL,\n                    cloudId: item.fileID,\n                    fileName: item.fileID.split('/').pop(),\n                    contentType,\n                    mime: contentType.split(';')[0].trim(),\n                    size: fileSize\n                };\n                return fileInfo;\n            }\n            catch (e) {\n                return {\n                    code: 'FETCH_FILE_INFO_ERROR',\n                    fileID: item.fileID,\n                    tempFileURL: item.tempFileURL\n                };\n            }\n        }));\n        return {\n            fileList,\n            requestId: fileInfo.requestId\n        };\n    }\n    return {\n        fileList: [],\n        requestId: fileInfo.requestId\n    };\n}\nexports.getFileInfo = getFileInfo;\nasync function downloadFile(cloudbase, { fileID, urlType, tempFilePath }, opts) {\n    const tmpUrlRes = await getTempFileURL(cloudbase, {\n        fileList: [\n            {\n                fileID,\n                urlType,\n                maxAge: 600\n            }\n        ]\n    }, opts);\n    const res = tmpUrlRes.fileList[0];\n    if (res.code !== 'SUCCESS') {\n        return (0, utils_1.processReturn)(Object.assign({}, res));\n    }\n    // COS_URL 场景下，不需要再进行 Encode URL\n    const tmpUrl = urlType === 'COS_URL' ? res.tempFileURL : encodeURI(res.tempFileURL);\n    return await new Promise((resolve, reject) => {\n        const reqOpts = {\n            method: 'get',\n            url: tmpUrl,\n            type: tempFilePath ? 'stream' : 'raw'\n        };\n        const req = (0, request_core_1.request)(reqOpts, (err, res, body) => {\n            if (err) {\n                reject(err);\n            }\n            else {\n                if (tempFilePath) {\n                    res.pipe(fs_1.default.createWriteStream(tempFilePath, { autoClose: true }));\n                }\n                if (res.statusCode === 200) {\n                    resolve({\n                        fileContent: tempFilePath ? undefined : body,\n                        message: '文件下载完成'\n                    });\n                }\n                else {\n                    reject((0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.STORAGE_REQUEST_FAIL), { message: `下载文件失败: Status:${res.statusCode} Url:${tmpUrl}`, requestId: res.headers['x-cos-request-id'] })));\n                }\n            }\n        });\n        req.on('error', (err) => {\n            if (tempFilePath) {\n                fs_1.default.unlinkSync(tempFilePath);\n            }\n            reject(err);\n        });\n    });\n}\nexports.downloadFile = downloadFile;\nasync function getUploadMetadata(cloudbase, { cloudPath }, opts) {\n    const params = {\n        action: 'storage.getUploadMetadata',\n        path: cloudPath,\n        method: 'put' // 使用 put 方式上传\n    };\n    const res = await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    });\n    return res;\n}\nexports.getUploadMetadata = getUploadMetadata;\nasync function getFileAuthority(cloudbase, { fileList }, opts) {\n    const { LOGINTYPE } = cloudbase_1.CloudBase.getCloudbaseContext();\n    if (!Array.isArray(fileList)) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '[node-sdk] getCosFileAuthority fileList must be a array' }));\n    }\n    if (fileList.some(file => {\n        if (!(file === null || file === void 0 ? void 0 : file.path)) {\n            return true;\n        }\n        if (!['READ', 'WRITE', 'READWRITE'].includes(file.type)) {\n            return true;\n        }\n        return false;\n    })) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '[node-sdk] getCosFileAuthority fileList param error' }));\n    }\n    const userInfo = cloudbase.auth().getUserInfo();\n    const { openId, uid } = userInfo;\n    if (!openId && !uid) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '[node-sdk] admin do not need getCosFileAuthority.' }));\n    }\n    const params = {\n        action: 'storage.getFileAuthority',\n        openId,\n        uid,\n        loginType: LOGINTYPE,\n        fileList\n    };\n    const res = await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    });\n    if (res.code) {\n        /* istanbul ignore next  */\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, res), { message: '[node-sdk] getCosFileAuthority failed: ' + res.code }));\n    }\n    else {\n        return res;\n    }\n}\nexports.getFileAuthority = getFileAuthority;\nasync function copyFile(cloudbase, { fileList }, opts) {\n    // 参数校验\n    if (!fileList || !Array.isArray(fileList) || fileList.length === 0) {\n        return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'fileList必须是非空的数组' }));\n    }\n    const list = [];\n    for (const file of fileList) {\n        const { srcPath, dstPath } = file;\n        if (!srcPath || !dstPath || typeof srcPath !== 'string' || typeof dstPath !== 'string') {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'srcPath和dstPath必须是非空的字符串' }));\n        }\n        if (srcPath === dstPath) {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'srcPath和dstPath不能相同' }));\n        }\n        if (path_1.default.basename(srcPath) !== path_1.default.basename(dstPath)) {\n            return (0, utils_1.processReturn)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'srcPath和dstPath的文件名必须相同' }));\n        }\n        list.push({\n            src_path: srcPath,\n            dst_path: dstPath,\n            overwrite: file.overwrite,\n            remove_original: file.removeOriginal\n        });\n    }\n    const params = {\n        action: 'storage.batchCopyFile',\n        file_list: list\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    }).then(res => {\n        if (res.code) {\n            return res;\n        }\n        return {\n            fileList: res.data.copy_list,\n            requestId: res.requestId\n        };\n    });\n}\nexports.copyFile = copyFile;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.wxCallContainerApi = exports.callWxPayApi = exports.callCompatibleWxOpenApi = exports.callWxOpenApi = void 0;\nconst tcbapicaller = __importStar(require(\"../utils/tcbapirequester\"));\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nfunction validateCrossAccount(config, opts = {}) {\n    const getCrossAccountInfo = opts.getCrossAccountInfo || config.getCrossAccountInfo;\n    if (getCrossAccountInfo) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'invalid config: getCrossAccountInfo' }));\n    }\n}\nasync function callWxOpenApi(cloudbase, { apiName, apiOptions, cgiName, requestData }, opts) {\n    let transformRequestData;\n    try {\n        transformRequestData = requestData ? JSON.stringify(requestData) : '';\n    }\n    catch (e) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, e), { code: code_1.ERROR.INVALID_PARAM.code, message: '对象出现了循环引用' }));\n    }\n    validateCrossAccount(cloudbase.config, opts);\n    const params = {\n        action: 'wx.api',\n        apiName,\n        apiOptions,\n        cgiName,\n        requestData: transformRequestData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        opts,\n        headers: {\n            'content-type': 'application/json'\n        }\n    }).then(res => {\n        if (res.code) {\n            return res;\n        }\n        let result;\n        try {\n            result = JSON.parse(res.data.responseData);\n        }\n        catch (e) {\n            result = res.data.responseData;\n        }\n        return {\n            result,\n            requestId: res.requestId\n        };\n    });\n}\nexports.callWxOpenApi = callWxOpenApi;\n/**\n * 调用wxopenAPi\n * @param {String} apiName  接口名\n * @param {Buffer} requestData\n * @return {Promise} 正常内容为buffer，报错为json {code:'', message:'', resquestId:''}\n */\nasync function callCompatibleWxOpenApi(cloudbase, { apiName, apiOptions, cgiName, requestData }, opts) {\n    validateCrossAccount(cloudbase.config, opts);\n    const params = {\n        action: 'wx.openApi',\n        apiName,\n        apiOptions,\n        cgiName,\n        requestData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        method: 'post',\n        headers: { 'content-type': 'multipart/form-data' },\n        params,\n        isFormData: true,\n        opts\n    }).then(res => res);\n}\nexports.callCompatibleWxOpenApi = callCompatibleWxOpenApi;\n/**\n * wx.wxPayApi 微信支付用\n * @param {String} apiName  接口名\n * @param {Buffer} requestData\n * @return {Promise} 正常内容为buffer，报错为json {code:'', message:'', resquestId:''}\n */\nasync function callWxPayApi(cloudbase, { apiName, apiOptions, cgiName, requestData }, opts) {\n    validateCrossAccount(cloudbase.config, opts);\n    const params = {\n        action: 'wx.wxPayApi',\n        apiName,\n        apiOptions,\n        cgiName,\n        requestData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        method: 'post',\n        headers: { 'content-type': 'multipart/form-data' },\n        params,\n        isFormData: true,\n        opts\n    });\n}\nexports.callWxPayApi = callWxPayApi;\n/**\n * wx.wxCallContainerApi\n * @param {String} apiName  接口名\n * @param {Buffer} requestData\n * @return {Promise} 正常内容为buffer，报错为json {code:'', message:'', resquestId:''}\n */\nasync function wxCallContainerApi(cloudbase, { apiName, apiOptions, cgiName, requestData }, opts) {\n    validateCrossAccount(cloudbase.config, opts);\n    const params = {\n        action: 'wx.wxCallContainerApi',\n        apiName,\n        apiOptions,\n        cgiName,\n        requestData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        method: 'post',\n        headers: { 'content-type': 'multipart/form-data' },\n        params,\n        isFormData: true,\n        opts\n    });\n}\nexports.wxCallContainerApi = wxCallContainerApi;\n","\n/* eslint-disable @typescript-eslint/naming-convention */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.analytics = void 0;\nconst tcbapicaller = __importStar(require(\"../utils/tcbapirequester\"));\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst cloudbase_1 = require(\"../cloudbase\");\nconst reportTypes = ['mall'];\nfunction validateAnalyticsData(data) {\n    if (Object.prototype.toString.call(data).slice(8, -1) !== 'Object') {\n        return false;\n    }\n    const { report_data, report_type } = data;\n    if (!reportTypes.includes(report_type)) {\n        return false;\n    }\n    if (Object.prototype.toString.call(report_data).slice(8, -1) !== 'Object') {\n        return false;\n    }\n    if (report_data.action_time !== undefined && !Number.isInteger(report_data.action_time)) {\n        return false;\n    }\n    if (typeof report_data.action_type !== 'string') {\n        return false;\n    }\n    return true;\n}\nasync function analytics(cloudbase, requestData) {\n    // 获取openid, wxappid\n    const { WX_OPENID, WX_APPID } = cloudbase_1.CloudBase.getCloudbaseContext();\n    if (!validateAnalyticsData(requestData)) {\n        throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: '当前的上报数据结构不符合规范' }));\n    }\n    const action_time = requestData.report_data.action_time === undefined ? Math.floor(Date.now() / 1000) : requestData.report_data.action_time;\n    const transformRequestData = {\n        analytics_scene: requestData.report_type,\n        analytics_data: Object.assign(Object.assign({ openid: WX_OPENID, wechat_mini_program_appid: WX_APPID }, requestData.report_data), { action_time })\n    };\n    const params = {\n        action: 'analytics.report',\n        requestData: transformRequestData\n    };\n    return await tcbapicaller.request({\n        config: cloudbase.config,\n        params,\n        method: 'post',\n        headers: {\n            'content-type': 'application/json'\n        }\n    });\n}\nexports.analytics = analytics;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createAI = void 0;\nconst ai_1 = require(\"@cloudbase/ai\");\nconst request_adapter_1 = require(\"./request-adapter\");\nconst tcbopenapiendpoint_1 = require(\"../utils/tcbopenapiendpoint\");\nconst symbol_1 = require(\"../const/symbol\");\nconst openapicommonrequester = __importStar(require(\"../utils/tcbopenapicommonrequester\"));\nconst app_1 = require(\"@cloudbase/app\");\n/**\n * 创建 AI 实例\n * @param cloudbase CloudBase 实例\n * @returns AI 实例\n */\nfunction createAI(cloudbase) {\n    const config = cloudbase.config;\n    // 获取环境 ID\n    const envId = config.envName === symbol_1.SYMBOL_CURRENT_ENV ? openapicommonrequester.getEnvIdFromContext() : config.envName;\n    // 构建 AI 基础 URL\n    const baseUrl = (0, tcbopenapiendpoint_1.buildCommonOpenApiUrlWithPath)({\n        serviceUrl: config.serviceUrl,\n        envId,\n        path: '/v1',\n        region: config.region\n    });\n    // 创建请求适配器\n    const requestAdapter = new request_adapter_1.AIRequestAdapter(config, async () => {\n        const credential = await cloudbase.auth().getClientCredential();\n        return credential.access_token;\n    });\n    // 创建 AI 实例\n    const ai = new ai_1.AI(requestAdapter, baseUrl, { t: (s) => s, lang: app_1.LANGS.ZH, LANG_HEADER_KEY: 'Accept-Language' });\n    return ai;\n}\nexports.createAI = createAI;\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AIRequestAdapter = void 0;\nconst openapicommonrequester = __importStar(require(\"../utils/tcbopenapicommonrequester\"));\nconst web_streams_polyfill_1 = require(\"web-streams-polyfill\");\nconst utils_1 = require(\"../utils/utils\");\nclass AIRequestAdapter {\n    constructor(config, getAccessToken) {\n        this.config = config;\n        this.getAccessToken = getAccessToken;\n    }\n    async fetch(options) {\n        var _a, _b;\n        const { url, stream = false, timeout, method = 'POST', headers, body } = options;\n        const headersObj = {};\n        if (isHeaders(headers)) {\n            headers.forEach((value, key) => {\n                headersObj[key] = value;\n            });\n        }\n        else if (Array.isArray(headers)) {\n            headers.forEach(([k, v]) => (headersObj[k] = v));\n        }\n        else {\n            Object.assign(headersObj, headers);\n        }\n        let parsedBody;\n        if (typeof body === 'string') {\n            try {\n                parsedBody = JSON.parse(body);\n            }\n            catch (_c) {\n                parsedBody = body;\n            }\n        }\n        else {\n            parsedBody = body;\n        }\n        const token = await this.getAccessToken();\n        const result = await openapicommonrequester.request({\n            config: this.config,\n            data: parsedBody,\n            method: (method === null || method === void 0 ? void 0 : method.toUpperCase()) || 'POST',\n            url,\n            headers: Object.assign({ 'Content-Type': 'application/json' }, headersObj),\n            token,\n            opts: {\n                timeout: timeout || this.config.timeout,\n                stream\n            }\n        });\n        const { body: bodyData, headers: responseHeaders, statusCode } = result;\n        if (statusCode < 200 || statusCode >= 300) {\n            let errorMessage = `Request failed with status code ${statusCode}`;\n            let errorCode = `${statusCode}`;\n            let requestId = '';\n            let errorBody = null;\n            if (typeof bodyData === 'string') {\n                errorBody = bodyData;\n            }\n            else if (Buffer.isBuffer(bodyData)) {\n                errorBody = bodyData.toString('utf-8');\n            }\n            else if (bodyData && typeof bodyData === 'object' && typeof bodyData.on === 'function') {\n                errorBody = await readStreamToString(bodyData);\n            }\n            if (errorBody) {\n                try {\n                    const errorData = JSON.parse(errorBody);\n                    if ((_a = errorData.error) === null || _a === void 0 ? void 0 : _a.message) {\n                        errorMessage = errorData.error.message;\n                    }\n                    else if (errorData.message) {\n                        errorMessage = errorData.message;\n                    }\n                    if ((_b = errorData.error) === null || _b === void 0 ? void 0 : _b.code) {\n                        errorCode = errorData.error.code;\n                    }\n                    else if (errorData.code) {\n                        errorCode = errorData.code;\n                    }\n                    if (errorData.requestId) {\n                        requestId = errorData.requestId;\n                    }\n                }\n                catch (_d) {\n                    errorMessage = errorBody || errorMessage;\n                }\n            }\n            // 从响应头中获取 requestId\n            if (!requestId && responseHeaders) {\n                const headerRequestId = responseHeaders['x-cloudbase-request-id'] || responseHeaders['x-request-id'] || '';\n                requestId = Array.isArray(headerRequestId) ? headerRequestId[0] : headerRequestId;\n            }\n            throw (0, utils_1.E)({\n                code: errorCode,\n                message: errorMessage,\n                requestId\n            });\n        }\n        if (stream) {\n            // 对于流式响应,将 Node.js 原生流转换为 Web ReadableStream\n            let readableStream;\n            if (bodyData && typeof bodyData === 'object' && 'on' in bodyData && typeof bodyData.on === 'function') {\n                const nodeStream = bodyData;\n                // Node 12 兼容: 使用标志位追踪 stream 状态,避免重复 close 导致异常\n                let streamClosed = false;\n                readableStream = new web_streams_polyfill_1.ReadableStream({\n                    start(controller) {\n                        nodeStream.on('data', (chunk) => {\n                            if (streamClosed)\n                                return;\n                            controller.enqueue(new Uint8Array(chunk));\n                        });\n                        nodeStream.on('end', () => {\n                            if (streamClosed)\n                                return;\n                            streamClosed = true;\n                            controller.close();\n                        });\n                        nodeStream.on('error', (err) => {\n                            if (streamClosed)\n                                return;\n                            streamClosed = true;\n                            controller.error(err);\n                        });\n                    },\n                    cancel() {\n                        streamClosed = true;\n                        nodeStream.destroy();\n                    }\n                });\n            }\n            else if (bodyData instanceof Buffer) {\n                readableStream = new web_streams_polyfill_1.ReadableStream({\n                    start(controller) {\n                        controller.enqueue(new Uint8Array(bodyData));\n                        controller.close();\n                    }\n                });\n            }\n            else if (typeof bodyData === 'string') {\n                const encoder = new TextEncoder();\n                readableStream = new web_streams_polyfill_1.ReadableStream({\n                    start(controller) {\n                        controller.enqueue(encoder.encode(bodyData));\n                        controller.close();\n                    }\n                });\n            }\n            else {\n                readableStream = new web_streams_polyfill_1.ReadableStream({\n                    start(controller) {\n                        controller.close();\n                    }\n                });\n            }\n            return {\n                data: readableStream,\n                statusCode,\n                header: responseHeaders\n            };\n        }\n        let responseData;\n        if (typeof bodyData === 'string') {\n            try {\n                responseData = JSON.parse(bodyData);\n            }\n            catch (_e) {\n                responseData = bodyData;\n            }\n        }\n        else if (bodyData instanceof Buffer) {\n            const bodyString = bodyData.toString('utf-8');\n            try {\n                responseData = JSON.parse(bodyString);\n            }\n            catch (_f) {\n                responseData = bodyString;\n            }\n        }\n        else {\n            responseData = bodyData;\n        }\n        return {\n            data: Promise.resolve(responseData),\n            statusCode,\n            header: responseHeaders\n        };\n    }\n    /**\n     * post 方法 - AI 模块可能不使用,但需要实现接口\n     */\n    async post() {\n        throw new Error('post method is not supported in AI module');\n    }\n    /**\n     * upload 方法 - AI 模块可能不使用,但需要实现接口\n     */\n    async upload() {\n        throw new Error('upload method is not supported in AI module');\n    }\n    /**\n     * download 方法 - AI 模块可能不使用,但需要实现接口\n     */\n    async download() {\n        throw new Error('download method is not supported in AI module');\n    }\n}\nexports.AIRequestAdapter = AIRequestAdapter;\nfunction isHeaders(h) {\n    try {\n        // Node.js 低版本可能没有 Headers\n        return h instanceof Headers;\n    }\n    catch (_) {\n        return false;\n    }\n}\n/**\n * 从 Node.js 流中读取完整内容为字符串\n */\nasync function readStreamToString(stream) {\n    return await new Promise((resolve, reject) => {\n        const chunks = [];\n        stream.on('data', (chunk) => {\n            chunks.push(chunk);\n        });\n        stream.on('end', () => {\n            resolve(Buffer.concat(chunks).toString('utf-8'));\n        });\n        stream.on('error', (err) => {\n            reject(err);\n        });\n    });\n}\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.logger = exports.Logger = void 0;\nconst utils_1 = require(\"../utils/utils\");\nconst code_1 = require(\"../const/code\");\nconst cloudbase_1 = require(\"../cloudbase\");\nclass Logger {\n    constructor() {\n        const { _SCF_TCB_LOG } = cloudbase_1.CloudBase.getCloudbaseContext();\n        this.src = 'app';\n        this.isSupportClsReport = true;\n        if (`${_SCF_TCB_LOG}` !== '1') {\n            this.isSupportClsReport = false;\n        }\n        else if (!console.__baseLog__) {\n            this.isSupportClsReport = false;\n        }\n        if (!this.isSupportClsReport) {\n            console.warn('[TCB][WARN] 请检查您是否在本地环境 或者 未开通高级日志功能，当前环境下无法上报cls日志，默认使用 console');\n        }\n    }\n    transformMsg(logMsg) {\n        // 目前 logMsg 只支持字符串 value 且不支持多级, 加一层转换处理\n        let realMsg = {};\n        realMsg = Object.assign(Object.assign({}, realMsg), logMsg);\n        return realMsg;\n    }\n    baseLog(logMsg, logLevel) {\n        if (Object.prototype.toString.call(logMsg).slice(8, -1) !== 'Object') {\n            throw (0, utils_1.E)(Object.assign(Object.assign({}, code_1.ERROR.INVALID_PARAM), { message: 'log msg must be an object' }));\n        }\n        const msgContent = this.transformMsg(logMsg);\n        if (this.isSupportClsReport) {\n            ;\n            console.__baseLog__(msgContent, logLevel);\n        }\n        else {\n            if (console[logLevel]) {\n                console[logLevel](msgContent);\n            }\n        }\n    }\n    log(logMsg) {\n        this.baseLog(logMsg, 'log');\n    }\n    info(logMsg) {\n        this.baseLog(logMsg, 'info');\n    }\n    warn(logMsg) {\n        this.baseLog(logMsg, 'warn');\n    }\n    error(logMsg) {\n        this.baseLog(logMsg, 'error');\n    }\n}\nexports.Logger = Logger;\nfunction logger() {\n    return new Logger();\n}\nexports.logger = logger;\n","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sendNotification = void 0;\nconst functions_1 = require(\"../functions\");\n/**\n   * SDK推送消息接口\n   * @param params\n   * notifyId: 通知策略Id\n   * data: 通知策略下的模板变量对应值\n   * receivers: 待通知的用户名\n   * url: 点击消息卡片打开的链接\n   * @returns\n   */\nasync function sendNotification(cloudbase, params, opts) {\n    return await (0, functions_1.callFunction)(cloudbase, {\n        name: 'lowcode-datasource',\n        data: {\n            methodName: 'callWedaApi',\n            params: {\n                action: 'PushNotifyMsg',\n                data: {\n                    NotifyId: params.notifyId,\n                    Data: JSON.stringify(params.data),\n                    NotifyUsers: undefined,\n                    Url: params.url\n                }\n            },\n            mode: 'c'\n        }\n    }, opts);\n}\nexports.sendNotification = sendNotification;\n"]}